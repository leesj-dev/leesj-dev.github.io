{"componentChunkName":"component---src-templates-blog-template-js","path":"/subway-live-3/","result":{"data":{"cur":{"id":"5c02a89a-3c7b-55ef-9ce9-bbdb13493d65","html":"<h2 id=\"0-들어가며\" style=\"position:relative;\"><a href=\"#0-%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\" aria-label=\"0 들어가며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0. 들어가며</h2>\n<p>다음으로는 데이터를 수집하고 처리하여 최종적으로 <code class=\"language-text\">역별 시간표</code>와 <code class=\"language-text\">열차별 시간표</code> 이 두 가지를 생성하는 과정을 거쳤다.</p>\n<h2 id=\"1-카카오맵-api에서-역-id-찾기\" style=\"position:relative;\"><a href=\"#1-%EC%B9%B4%EC%B9%B4%EC%98%A4%EB%A7%B5-api%EC%97%90%EC%84%9C-%EC%97%AD-id-%EC%B0%BE%EA%B8%B0\" aria-label=\"1 카카오맵 api에서 역 id 찾기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 카카오맵 API에서 역 ID 찾기</h2>\n<p>iPhone 카카오맵 앱에서 출발지점을 바꿔가며 역 ID를 찾아내었는데, 대부분 연속된 숫자라 찾기 그렇게 어렵지는 않았다. 다만 새로 개통한 <em>1호선 다대포해수욕장 연장구간</em>, <em>동해선 태화강 연장구간</em>, <em>동해선 부산원동역</em> 이 세 가지는 다소 변칙적이었다.</p>\n<ul>\n<li>1호선\n<ul>\n<li>신평~노포: <code class=\"language-text\">PSS101</code>~<code class=\"language-text\">PSS134</code></li>\n<li>동매~다대포해수욕장: <code class=\"language-text\">PSS1M159</code>~<code class=\"language-text\">PSS1M164</code></li>\n</ul>\n</li>\n<li>2호선\n<ul>\n<li>장산~양산: <code class=\"language-text\">PSS201</code>~<code class=\"language-text\">PSS243</code></li>\n</ul>\n</li>\n<li>3호선\n<ul>\n<li>수영~대저: <code class=\"language-text\">PSS301</code>~<code class=\"language-text\">PSS317</code></li>\n</ul>\n</li>\n<li>4호선\n<ul>\n<li>미남~안평: <code class=\"language-text\">PSS401</code>~<code class=\"language-text\">PSS414</code></li>\n</ul>\n</li>\n<li>부산김해경전철\n<ul>\n<li>사상~가야대: <code class=\"language-text\">PSS1001</code>~<code class=\"language-text\">PSS1021</code></li>\n</ul>\n</li>\n<li>동해선\n<ul>\n<li>부전~일광 (부산원동 제외): <code class=\"language-text\">PSS11M144</code>~<code class=\"language-text\">PSS11M157</code></li>\n<li>부산원동: <code class=\"language-text\">PSS11M226</code></li>\n<li>좌천~태화강: <code class=\"language-text\">PSS11M248</code>~<code class=\"language-text\">PSS11M255</code></li>\n</ul>\n</li>\n</ul>\n<p>이 데이터를 최종적으로 <code class=\"language-text\">stations.json</code>에 저장하였다.</p>\n<h2 id=\"2-전체-역-시간표-만들기\" style=\"position:relative;\"><a href=\"#2-%EC%A0%84%EC%B2%B4-%EC%97%AD-%EC%8B%9C%EA%B0%84%ED%91%9C-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"2 전체 역 시간표 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 전체 역 시간표 만들기</h2>\n<p>이 파트가 전체 모든 과정 중 가장 애를 먹였는데, 처음에는 코드만 잘 짜놓으면 쉽게 넘어갈 수 있다고 생각했으나 예상치 못했던 변수가 너무 많았기 때문이다. 근본적으로는 raw data 자체에 문제가 많았기 때문이라고 볼 수 있다.</p>\n<h3 id=\"2-1-raw-data-찾기\" style=\"position:relative;\"><a href=\"#2-1-raw-data-%EC%B0%BE%EA%B8%B0\" aria-label=\"2 1 raw data 찾기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-1. raw data 찾기</h3>\n<p>총 4가지의 raw data를 찾을 수 있었는데, 그 중 완벽한 데이터는 없었다. 문제점 중 골치 아프지만 해결이 불가능하지는 않은 것은 ⚠️, 해결 자체가 불가능한 것은 ❌로 표시하였다.</p>\n<ol>\n<li><strong>카카오맵 내부 API</strong></li>\n</ol>\n<ul>\n<li><a href=\"https://api.kakao.com/subway/station/timetable.json\">https://api.kakao.com/subway/station/timetable.json</a> (실제 링크는 아님) 뒤 역 ID를 입력하여 요청을 보내면 JSON 포맷으로 가공되어 데이터가 나오기 때문에 매우 쉽게 처리가 가능하다.</li>\n<li>문제점\n<ol>\n<li>❌ <strong>열차번호 정보가 없다</strong>. 이 데이터로 역별 시간표는 만들 수 있지만, 열차별 시간표는 만들 수 없다.</li>\n<li>❌ 종착역에 도착하는 열차의 도착시간 정보가 없다.</li>\n</ol>\n</li>\n</ul>\n<ol start=\"2\">\n<li><strong>공공데이터포털/레일포털 운행정보</strong></li>\n</ol>\n<ul>\n<li>공공데이터포털에 부산교통공사에서 제공하는 <a href=\"https://www.data.go.kr/data/15082980/fileData.do\">부산도시철도 운행 정보</a>라는 csv 파일이 있다. 이 파일에는 열차별 &#x26; 역별 도착 및 출발시각이 모두 들어있다.</li>\n<li>조사를 좀 더 해보니 레일포털에서는 <a href=\"https://data.kric.go.kr/rips/M_01_01/detail.do?id=11\">부산교통공사</a>뿐만 아니라 <a href=\"https://data.kric.go.kr/rips/M_01_01/detail.do?id=12\">김해경전철</a>, <a href=\"https://data.kric.go.kr/rips/M_01_01/detail.do?id=6\">코레일</a> 등 전체 운영기관의 xlsx 파일을 제공한다.</li>\n<li>문제점\n<ol>\n<li>❌ 부산김해경전철 파일에서 평일, 토요일, 휴일 시간표를 모두 같게 해놨다.</li>\n<li>❌ 동해선 파일에서 역별 도착, 출발 시간이 표시되어 있지 않다.</li>\n<li>⚠️ 역별 도착 및 출발시각이 분 단위로 있어, 초 단위 정보는 <code class=\"language-text\">방법 1</code>로 얻어야 한다. 이때 대부분의 경우 표기된 시각이 초 시각을 버림한 경우이지만, 일부 열차에서는 초 시각을 반올림하여 시간이 맞지 않은 경우가 있다. 이 경우 오류가 나는 경우를 csv에서 일일이 찾아서 파일을 수정해야 한다.</li>\n</ol>\n</li>\n</ul>\n<ol start=\"3\">\n<li><strong>레일블루</strong></li>\n</ol>\n<ul>\n<li>개인이 운영하는 철도 정보 관련 웹사이트이다. 이 중 <a href=\"https://rail.blue/railroad/logis/timetable_schedule_sel.aspx\">전철노선시간표</a>에 들어가 정보를 입력하면 열차별 &#x26; 역별 도착 및 출발시각이 조회 가능하다.</li>\n<li>문제점\n<ol>\n<li>❌ 부산김해경전철의 열차번호가 후술할 레일포털에서 제공하는 표준데이터의 열차번호와 다르다.</li>\n<li>❌ 부산김해경전철 토⋅일⋅공휴일의 가야대행 막차 직전 열차의 정보가 없다. 추측컨대 예전에 없다가 최근에 새로 생긴 듯한데, 아직 레일블루에 업데이트되지 않았다.</li>\n<li>❌ 동해선 전철노선시간표에 재송역이 빠져 있다.</li>\n<li>⚠️ 4호선 (전)동부산대학역이 아직 (현)윗반송역으로 업데이트되지 않았다. 이로 인해 윗반송역 시간표가 텅 비어있다.</li>\n<li>⚠️ 동해선 일광~태화강 구간의 일부 열차에서 카카오맵 API와 다르게 표시되어 있다.</li>\n</ol>\n</li>\n</ul>\n<ol start=\"4\">\n<li><strong>레일포털 Open API</strong></li>\n</ol>\n<ul>\n<li>국토교통부에서 제공하는 Open API 중 <a href=\"https://data.kric.go.kr/rips/M_01_02/detail.do?id=162&#x26;service=trainUseInfo&#x26;operation=subwayTimetable\">열차별 운행시각표</a>가 있다. 본인인증을 하고 활용신청을 하니 얼마 지나지 않아 메일로 <code class=\"language-text\">serviceKey</code>를 받을 수 있었다.</li>\n<li>요일 코드(<code class=\"language-text\">dayCd</code>)는 토요일이 <code class=\"language-text\">7</code>, 평일이 <code class=\"language-text\">8</code>, 휴일이 <code class=\"language-text\">9</code>이다.</li>\n<li>노선 코드(<code class=\"language-text\">lnCd</code>), 운영기관 코드(<code class=\"language-text\">railOprIsttCd</code>), 역 코드(<code class=\"language-text\">stinCd</code>) 정보는 <a href=\"https://data.kric.go.kr/rips/M_04_02/detail.do?id=12\">자료실</a>에서 엑셀 파일로 제공한다.</li>\n<li>문제점\n<ol>\n<li>⚠️ 도착시간은 제대로 표시되어 있지만, 출발시간을 도착시간과 동일하게 표시해놓았다. 이는 <code class=\"language-text\">방법 1</code>과 병용하면 해결이 가능하다.</li>\n<li>⚠️ 1~4호선, 김해경전철 일부 열차에서 시간이 카카오맵 API와 다르게 표시되어 있다.</li>\n<li>⚠️ 일부 열차에서 시각이 <code class=\"language-text\">방법 1</code>과 다르게 표기되어 있어 문제가 되는 부분을 수동으로 수정해야 한다.</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"2-2-데이터-전처리-방법-계획하기\" style=\"position:relative;\"><a href=\"#2-2-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%84%EC%B2%98%EB%A6%AC-%EB%B0%A9%EB%B2%95-%EA%B3%84%ED%9A%8D%ED%95%98%EA%B8%B0\" aria-label=\"2 2 데이터 전처리 방법 계획하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-2. 데이터 전처리 방법 계획하기</h3>\n<p><strong>⭐️ 전제: raw data간 시간이 서로 달라 충돌하는 경우, 항상 <code class=\"language-text\">방법 1</code>의 시간을 취한다.</strong></p>\n<p>아래에 정리된 바와 같이, <code class=\"language-text\">방법 2</code>, <code class=\"language-text\">방법 3</code>, <code class=\"language-text\">방법 4</code> 모두 결점이 있어서 <code class=\"language-text\">방법 1</code>과의 비교를 통해 보완을 해야 했다.</p>\n<ul>\n<li>(<code class=\"language-text\">방법 2</code>) 공공데이터포털/레일포털 운행정보\n<ul>\n<li>⚠️ 부산교통공사 관할 1~4호선: 오류가 나는 열차에 대해 일일이 csv에서 수정해줘야 한다.</li>\n<li>❌ 부산김해경전철: 토요일 및 휴일 시간표가 없다.</li>\n<li>❌ 동해선: 역별 도착, 출발 시간이 표시되어 있지 않다.</li>\n</ul>\n</li>\n<li>(<code class=\"language-text\">방법 3</code>) 레일블루\n<ul>\n<li>⚠️ 부산교통공사 관할 1~4호선: 4호선 윗반송역 시간표가 텅 비어있는데, 이를 채우기엔 다소 까다롭다.</li>\n<li>❌ 부산김해경전철: 열차번호가 표준이 아니며, 토⋅일⋅공휴일의 가야대행 막차 직전 열차의 정보가 없다.</li>\n<li>❌ 동해선: 재송역 열차시간이 존재하지 않는다.</li>\n</ul>\n</li>\n<li>(<code class=\"language-text\">방법 4</code>) 레일포털 Open API\n<ul>\n<li>⚠️ 부산교통공사 관할 1~4호선: 일부 열차에서 시간이 다르게 표시되어 있어 직접 수정이 필요하다.</li>\n<li>⚠️ 김해경전철: 마찬가지 문제가 있다.</li>\n<li>✅ 동해선: 별다른 문제가 없다.</li>\n</ul>\n</li>\n</ul>\n<p>처음에는 부산교통공사 관할 1~4호선에서는 <code class=\"language-text\">방법 2</code>를, 나머지 노선들에 대해서는 <code class=\"language-text\">방법 4</code>를 이용하였는데, <code class=\"language-text\">방법 2</code>에서 문제가 있는 데이터가 너무 많아(<code class=\"language-text\">방법 2</code>의 <code class=\"language-text\">문제점 iii</code>) <code class=\"language-text\">방법 4</code>로 통일하였다.</p>\n<h3 id=\"2-3-데이터-전처리-하기\" style=\"position:relative;\"><a href=\"#2-3-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%84%EC%B2%98%EB%A6%AC-%ED%95%98%EA%B8%B0\" aria-label=\"2 3 데이터 전처리 하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-3. 데이터 전처리 하기</h3>\n<p>이제 본격적으로 데이터를 전처리해보겠다. 전처리의 각 과정에 등장하는 코드의 설명까지 일일이 달기에는 문서 양이 너무 방대해져, 코드의 주요 부분에 주석으로 설명을 단 뒤 Github 링크를 걸어두도록 하겠다.</p>\n<ol>\n<li><a href=\"https://data.kric.go.kr/rips/M_04_02/detail.do?id=12\">코드 정보</a>를 받아와서 전처리 후 <code class=\"language-text\">codes.csv</code> 파일로 저장</li>\n<li><a href=\"https://github.com/leesj-dev/subway-live/blob/master/preprocessing/scripts/1-save_arrival.py\"><code class=\"language-text\">1-save_arrival.py</code></a> 실행 → <code class=\"language-text\">arrival_original.json</code>으로 저장</li>\n</ol>\n<ul>\n<li>이 코드는 <code class=\"language-text\">방법 1</code>과 <code class=\"language-text\">방법 4</code>에서 열차번호, 종착역, 출발시각, 도착시각 정보를 가져와 <code class=\"language-text\">arrival_original.json</code>에 저장한다.</li>\n<li><code class=\"language-text\">방법 1</code>과 <code class=\"language-text\">방법 4</code> 간 시간이 맞지 않은 부분이 몇 개 있어 열차번호가 모두 채워지지 않는데(<code class=\"language-text\">방법 4</code>의 <code class=\"language-text\">문제점 ii</code>), 이러한 문제가 발생하는 경우를 모두 정리하여 if문으로 예외처리하였다.</li>\n</ul>\n<ol start=\"3\">\n<li><a href=\"https://github.com/leesj-dev/subway-live/blob/master/preprocessing/scripts/2-fill_end_station.py\"><code class=\"language-text\">2-fill_end_station.py</code></a> 실행 → <code class=\"language-text\">arrival.json</code>으로 저장</li>\n</ol>\n<ul>\n<li>이 코드는 <code class=\"language-text\">방법 4</code>를 통해 종착역에 도착하는 열차 정보를 가져옴으로써 <code class=\"language-text\">방법 1</code>의 <code class=\"language-text\">문제점 ii</code>를 해결한다. <code class=\"language-text\">arrival_original.json</code>에서 종착역이 없는 열차들을 채워 <code class=\"language-text\">arrival.json</code>에 저장한다.</li>\n</ul>\n<p>환경변수는 <a href=\"https://github.com/leesj-dev/subway-live/blob/master/preprocessing/scripts/env_variables.py\"><code class=\"language-text\">env_variables.py</code></a>, 파일경로는 <a href=\"https://github.com/leesj-dev/subway-live/blob/master/preprocessing/scripts/paths.py\"><code class=\"language-text\">paths.py</code></a>, 재사용하는 함수들은 <a href=\"https://github.com/leesj-dev/subway-live/blob/master/preprocessing/scripts/utils.py\"><code class=\"language-text\">utils.py</code></a>에 넣어 필요할 때 불러와 사용하였다.</p>\n<h2 id=\"3-개별-열차-시간표-파일-생성\" style=\"position:relative;\"><a href=\"#3-%EA%B0%9C%EB%B3%84-%EC%97%B4%EC%B0%A8-%EC%8B%9C%EA%B0%84%ED%91%9C-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1\" aria-label=\"3 개별 열차 시간표 파일 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 개별 열차 시간표 파일 생성</h2>\n<ul>\n<li><a href=\"https://github.com/leesj-dev/subway-live/blob/master/preprocessing/scripts/3-save_traintable.py\"><code class=\"language-text\">3-save_traintable.py</code></a> 실행 → <code class=\"language-text\">traintable</code> 폴더에 열차별 시간표 생성</li>\n</ul>\n<h2 id=\"4-개별-역-시간표-파일-생성\" style=\"position:relative;\"><a href=\"#4-%EA%B0%9C%EB%B3%84-%EC%97%AD-%EC%8B%9C%EA%B0%84%ED%91%9C-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1\" aria-label=\"4 개별 역 시간표 파일 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 개별 역 시간표 파일 생성</h2>\n<ul>\n<li><a href=\"https://github.com/leesj-dev/subway-live/blob/master/preprocessing/scripts/4-save_timetable.py\"><code class=\"language-text\">4-save_timetable.py</code></a> 실행 →\n<ol>\n<li><code class=\"language-text\">timetable</code> 폴더에 역별 시간표 생성</li>\n<li><code class=\"language-text\">arrival.json</code> 중 부산교통공사(BTC)의 출발·도착시간 부분을 hh:mm에서 hh:mm:ss으로 업데이트</li>\n</ol>\n</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#0-%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\">0. 들어가며</a></p>\n</li>\n<li>\n<p><a href=\"#1-%EC%B9%B4%EC%B9%B4%EC%98%A4%EB%A7%B5-api%EC%97%90%EC%84%9C-%EC%97%AD-id-%EC%B0%BE%EA%B8%B0\">1. 카카오맵 API에서 역 ID 찾기</a></p>\n</li>\n<li>\n<p><a href=\"#2-%EC%A0%84%EC%B2%B4-%EC%97%AD-%EC%8B%9C%EA%B0%84%ED%91%9C-%EB%A7%8C%EB%93%A4%EA%B8%B0\">2. 전체 역 시간표 만들기</a></p>\n<ul>\n<li><a href=\"#2-1-raw-data-%EC%B0%BE%EA%B8%B0\">2-1. raw data 찾기</a></li>\n<li><a href=\"#2-2-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%84%EC%B2%98%EB%A6%AC-%EB%B0%A9%EB%B2%95-%EA%B3%84%ED%9A%8D%ED%95%98%EA%B8%B0\">2-2. 데이터 전처리 방법 계획하기</a></li>\n<li><a href=\"#2-3-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%84%EC%B2%98%EB%A6%AC-%ED%95%98%EA%B8%B0\">2-3. 데이터 전처리 하기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#3-%EA%B0%9C%EB%B3%84-%EC%97%B4%EC%B0%A8-%EC%8B%9C%EA%B0%84%ED%91%9C-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1\">3. 개별 열차 시간표 파일 생성</a></p>\n</li>\n<li>\n<p><a href=\"#4-%EA%B0%9C%EB%B3%84-%EC%97%AD-%EC%8B%9C%EA%B0%84%ED%91%9C-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1\">4. 개별 역 시간표 파일 생성</a></p>\n</li>\n</ul>\n</div>","excerpt":"0. 들어가며 다음으로는 데이터를 수집하고 처리하여 최종적으로 와  이 두 가지를 생성하는 과정을 거쳤다. 1. 카카오맵 API에서 역 ID 찾기 iPhone 카카오맵 앱에서 출발지점을 바꿔가며 역 ID를 찾아내었는데, 대부분 연속된 숫자라 찾기 그렇게 어렵지는 않았다. 다만 새로 개통한 1호선 다대포해수욕장 연장구간, 동해선 태화강 연장구간, 동해선 부산원동역 이 세 가지는 다소 변칙적이었다. 1호선 신평~노포: ~ 동매~다대포해수욕장: ~ 2호선 장산~양산: ~ 3호선 수영~대저: ~ 4호선 미남~안평: ~ 부산김해경전철 사상~가야대: ~ 동해선 부전~일광 (부산원동 제외): ~ 부산원동:  좌천~태화강: ~ 이 데이터를 최종적으로 에 저장하였다. 2. 전체 역 시간표 만들기 이 파트가 전체 모든 과정 중 가장 애를 먹였는데, 처음에는 코드만 잘 짜놓으면 쉽게 넘어갈 수 있다고 생각했으나 예상치 못했던 변수가 너무 많았기 때문이다. 근본적으로는 raw data 자체에 문제가 많…","frontmatter":{"date":"June 21, 2024","title":"subway-live 작업기 3부. 데이터 전처리","categories":"웹개발","author":"이승준","emoji":"🚇"},"fields":{"slug":"/subway-live-3/"}},"next":{"id":"bf631c6c-59c8-557f-bc71-09c6bd2fa33c","html":"<h2 id=\"0-들어가며\" style=\"position:relative;\"><a href=\"#0-%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\" aria-label=\"0 들어가며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0. 들어가며</h2>\n<p>부산 지하철 실시간 도착정보 서비스를 만들기 위해 가장 먼저 준비해야 하는 것은 그 <strong>실시간 도착정보를 가져오는 것</strong>이다. <a href=\"https://data.go.kr\">공공데이터포털</a>, <a href=\"https://data.kric.go.kr\">레일포털</a>, <a href=\"https://apis.map.kakao.com/web/\">카카오맵 API</a> 등을 모두 찾아 보았으나, OpenAPI 형태로 실시간 도착정보를 제공하는 곳은 없었다. 어쩔 수 없이 카카오맵 앱 내부적으로 사용되는 API를 사용하여 실시간 도착정보를 찾아내기로 했다. 이 내부 API는 외부에 공개되지 않기 때문에 네트워크 패킷을 분석하여 찾아내야 한다.</p>\n<h2 id=\"1-카카오맵-내부-api-찾아내기\" style=\"position:relative;\"><a href=\"#1-%EC%B9%B4%EC%B9%B4%EC%98%A4%EB%A7%B5-%EB%82%B4%EB%B6%80-api-%EC%B0%BE%EC%95%84%EB%82%B4%EA%B8%B0\" aria-label=\"1 카카오맵 내부 api 찾아내기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 카카오맵 내부 API 찾아내기</h2>\n<p>휴대폰에서 통신되는 네트워크 패킷을 컴퓨터에서 찾아낼 수 있는 소프트웨어를 검색해보니 <a href=\"https://www.charlesproxy.com/download/\">Charles Proxy</a>가 있었다. 30일 무료 평가판에 세션 시간 제한 등 제약이 있었지만, 카카오맵 내부 API를 찾아내는 데에는 문제가 없어 보였다. Charles Proxy를 Mac에 설치한 뒤 iPhone에서 몇 가지 설정을 만져 주었다.</p>\n<h3 id=\"1-1-iphone-wi-fi-설정-변경\" style=\"position:relative;\"><a href=\"#1-1-iphone-wi-fi-%EC%84%A4%EC%A0%95-%EB%B3%80%EA%B2%BD\" aria-label=\"1 1 iphone wi fi 설정 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-1. iPhone Wi-Fi 설정 변경</h3>\n<p>iPhone을 컴퓨터와 동일한 Wi-Fi 네트워크에 연결하고, <code class=\"language-text\">Settings > Wi-Fi > 해당 네트워크 옆 🛈</code>을 누르고 맨 밑으로 내려 <code class=\"language-text\">Configure Proxy</code>를 <code class=\"language-text\">Manual</code>로 바꿔주었다. Server는 컴퓨터의 IP 주소, Port는 <code class=\"language-text\">8888</code>로 설정하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 216.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAIAAAD3xz8iAAAACXBIWXMAAAsTAAALEwEAmpwYAAACeUlEQVR42u1W627aMBjN+z9GpT1Eq5V2g6oITas2Ki4JZMC4BEIuxPckkB3HjCFGU7SfE9bB+hznfPcYW0kigOUynE691Soyy7OIYxaGiecFtu1CxhMLP0LVt++dh4f642MjCBJC5GbDDzA0StN2u+s4P15e2jc3H3w/plRZJBGUCMEUZykhSusikvOMsRQzOHgJgtGIGUshcgjasj2XX0ay5cqfK0ETDi9ms1Wj0by9/VivN1utr5CfnprzuQ+acQTRIUy4Y/mhWKzF1BdBLIiOTUYRnUwW4/HcdSeet14ug9FoZsI5BB9FBIosQsDhlEAlIhQAtuEzHGYM3ioASyg1u+YFA50wITMpMyFSKfcQAoEdZi0ctspdDVi1pMzDMBwMBkVR7Ha74uJBqbQYU3meK6UM+ZKBFwFNFiJLkmQ8Hs9mM0JItX2zEfFCZgVn0uIciWFgLhYe5xx72+222mwsdirfMVa6nWVoBj3iOL7E/1O3+/0+coYZXrybud0hYSgVPE9T5EwDNeBcnQV8PMbvD4PIsntkHJuPQZwF2hPdUvaP2vd2uWZxvMFcmaoiSQg6IioH5+hCpWNGnmzbHg6HIFeEGgQBKjrFd+95SBOC1dkGB31yWXsUKI0QAgxtGe0Jlb1ez3SI8fysZeOX67rN5nMQrOGytnyiu9o4fERtIOzrvNlsut3u62vbcZxut4eCvxV8GWDm+76USscMBZAIoUgmITjWKOQ0RWj538BzzlEkqlS6bxIApTtGxRlq+uLPYfDPuJKv5Cv5vyYf36NO7lTvk8196QSHo+dNMtTjytXpOHd3tVrt8/39JwAClp2OjT+mE/u/AA9Vm+61LKuyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-1.png\"\n        title=\"\"\n        src=\"/static/e3c19cea906a4bff6d613557b6f64a7e/b4ad3/2-1.png\"\n        srcset=\"/static/e3c19cea906a4bff6d613557b6f64a7e/8c112/2-1.png 270w,\n/static/e3c19cea906a4bff6d613557b6f64a7e/03ec9/2-1.png 540w,\n/static/e3c19cea906a4bff6d613557b6f64a7e/b4ad3/2-1.png 1080w,\n/static/e3c19cea906a4bff6d613557b6f64a7e/c4688/2-1.png 1179w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"1-2-iphone에-ssl-인증서-설치\" style=\"position:relative;\"><a href=\"#1-2-iphone%EC%97%90-ssl-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%84%A4%EC%B9%98\" aria-label=\"1 2 iphone에 ssl 인증서 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-2. iPhone에 SSL 인증서 설치</h3>\n<p>iPhone의 Safari에서 <a href=\"https://chls.pro/ssl\">SSL 인증서</a>를 다운로드하여 설치하고, <code class=\"language-text\">Settings > General > About > Certificate Trust Settings > Enable Full Trust for Root Certificates</code> 경로로 가서 Charles Proxy의 인증서를 활성화하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 216.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAIAAAD3xz8iAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC7UlEQVR42u1W204bMRDND/e139C3fgJSPwPEpS0CBEhQSiOFhFz26t14vd6L7d21Az32hoirkCr1jWEymhn7xJ7jcfCgLBU0SVgQJHFMi0L2mZfKuWCsJCQbjaZ5XldVM7ADVXP568/BweHl5TWywD9TwOq6vboajsezi4vfW1vf0jRHZlCVqi6VEq2UnRBQ7axVDD/4WkqrWA1JpUy/l8Eoaq795nTajKKWUn50dLq7+31//+fx8dn5+eXJyfnZ2cXOzh6Sh4cnWBD4TWmDlClCpZfImErGKs+LfZ/M5+FiEWEqwjBMYRHe3nqYAExfiwXXlWpUq7uV1tA7Y6Cr1eoeoVK6bVdta2C7boU8fCSbBrazYFcJFrQym82SJIEznU6zLLt/JFrrLGN5nhdFgaG2BR3tAB9jDGLOubMFY4wQgm8E5u5BMEcIJYQErMHSRlswSFYKHBSYzZ3kThDePZXNFupaaG3WYCnlYrEIw3A+n/u+1ztxHN+/Jl3XMpavt426gQcl2AtY6W0fuu99ogCIdUe0ljCcG6VlEKRxnKH10pRH0ZIQlM2iiCZJDscNWUtp4foUPSd7MGhoyhJdWdc1fJy+4LxCyFiR5+WDVrAYcos3WNyC0WsgeTIZo8jJZIJqwzC4f0PQAdpo5o4KeEsYqAfboK1ygg1s6N2QbH33ZzpD8wycb45KUUqXS4oTxi5QVrpc8qLIOUcmQumU2saom7BJP4++3oiFMHINFqIOfW82nZA4JHEUR0EchZxly5QkCQk8W4jnexmhnoo/Db+MylmFhfsrmVdtzA0pVnFuotwQDrvyMzjaZyZgd6UwXWuk0spezzYteF03ju1SLZm9VUEq/VQunINw48yIxAT3kyC5u0xVCY7clbQBTqtWuF5Q0Wu9zvQ+Jrz6w2TBhdOXTvEo8yb4n/UD/AH+AH+A/wv45VNq8wh5H9y/l54pku+A3T8sPRyOt7f39vZ+4PkEhYNwOLzBg+zZ+n8BVzeDZAJWhnMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-2.png\"\n        title=\"\"\n        src=\"/static/dc76bda02ce5af533be44677ecfb63d0/b4ad3/2-2.png\"\n        srcset=\"/static/dc76bda02ce5af533be44677ecfb63d0/8c112/2-2.png 270w,\n/static/dc76bda02ce5af533be44677ecfb63d0/03ec9/2-2.png 540w,\n/static/dc76bda02ce5af533be44677ecfb63d0/b4ad3/2-2.png 1080w,\n/static/dc76bda02ce5af533be44677ecfb63d0/c4688/2-2.png 1179w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"1-3-charles-실행\" style=\"position:relative;\"><a href=\"#1-3-charles-%EC%8B%A4%ED%96%89\" aria-label=\"1 3 charles 실행 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-3. Charles 실행</h3>\n<p>카카오맵 앱에서 길찾기를 누르고 지하철이 포함된 동선으로 경로를 검색하면 Charles에서 요청을 보내는 링크를 확인할 수 있다. 외부에 공개된 API가 아니기 때문에 실제 링크 대신 가칭인 <code class=\"language-text\">https://api.kakao.com/subway</code>로 대체하였다.</p>\n<ul>\n<li>특정 역에서의 실시간 도착정보: <code class=\"language-text\">https://api.kakao.com/subway/station/arrivals.json?id=${stationID}</code></li>\n<li>특정 역의 시간표: <code class=\"language-text\">https://api.kakao.com/subway/station/timetable.json?id=${stationID}</code></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.4074074074074%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACtklEQVR42qVUy07bQBTNF/AR7U8QdigbvgF2LJDYZIHEgg9i0cYIwQKQWNAq6sM0DzmPQl5NYichxHawHb89M7d3Jk4XCFAlRjqa8dy5Z859jDPX0vGHcqn4udZsntSbzYKi1CRFUaSaUpUatZpUrValYrEoffn2XSrhulJTpAq3oy1FAXGCPp8uLi4+Zq4vL7Pd9m+m9bugP45Z6NkQehZYcx1Gqgp3d3cwnU7hUTcROuhzE+aWBbZlg23bYFkWWywWYBgGvbq62sjc/FTWv94bSVEZ0pbmJEODkL6eED8Gwighw+GQzGYz4rkuCcOQRIjA94nneQK+7ycIiqTx+fl5NnN8KWdv7l0md1341XWY3LbhR8uGmRWA7y1gPJkIJegESACu5wIhBBhjQCnlYIAjCAJ6enq6kSmXy9kkScQmjtUMcRyDaZqgYtjj8RhGo5EA30Ol/0hXPri3JJTlcjaKE2EiFBi/Dy9GwgQcxxEkPIc8T1whV+q6rlCNqiCKIoaC+Nm3FXIFeBg0TYPBoA86FoSrm8/nvBACfI1EjJ/lhIVC4XVCrm7+ZIGqjaDV7ohqNxoN6HQ6eMFAAAsG/X6fpelYVvk1QhsVGA8aWPoUMQEnDZGDh70CpoHxmSu8vb19nRBbBujTBOLZH4gMdZncl4cwIAetVCpv5DAOIdJViB0TEl7VdxFizUXVHR3C2QBiUwMa+e8npKEL0UMH/MceEHySz4J4mbBUKq1jt5PUSMUB7H7sRZb4CxbpQxYYKiOBy1Ln56ApIRGEsixneXM+v54/q5VarMhy/p+Qz87O1tvtNk2fF+Ovgjcx9hfgPvR6PdF7rVZLgK/xlwboLGzYj4z3ZL1ep+LnsLOzs7a/v7+5t7eX293dzeXz+dzh4eGbODo6Elh9Hxwc5La3tze3trbW/gLUR7ZtmLE17AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-3.png\"\n        title=\"\"\n        src=\"/static/f87433f6ea2c314b9e854e67b5ddf7e5/b4ad3/2-3.png\"\n        srcset=\"/static/f87433f6ea2c314b9e854e67b5ddf7e5/8c112/2-3.png 270w,\n/static/f87433f6ea2c314b9e854e67b5ddf7e5/03ec9/2-3.png 540w,\n/static/f87433f6ea2c314b9e854e67b5ddf7e5/b4ad3/2-3.png 1080w,\n/static/f87433f6ea2c314b9e854e67b5ddf7e5/399e3/2-3.png 1620w,\n/static/f87433f6ea2c314b9e854e67b5ddf7e5/36aa2/2-3.png 2160w,\n/static/f87433f6ea2c314b9e854e67b5ddf7e5/a7fe5/2-3.png 2606w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"2-프록시-서버-구축\" style=\"position:relative;\"><a href=\"#2-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%84%9C%EB%B2%84-%EA%B5%AC%EC%B6%95\" aria-label=\"2 프록시 서버 구축 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 프록시 서버 구축</h2>\n<h3 id=\"2-1-왜-프록시-서버가-필요한가\" style=\"position:relative;\"><a href=\"#2-1-%EC%99%9C-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%84%9C%EB%B2%84%EA%B0%80-%ED%95%84%EC%9A%94%ED%95%9C%EA%B0%80\" aria-label=\"2 1 왜 프록시 서버가 필요한가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-1. 왜 프록시 서버가 필요한가?</h3>\n<p>프론트엔드에서 해당 API를 바로 불러오면 두 가지 문제점이 발생한다.</p>\n<ul>\n<li><code class=\"language-text\">문제 1</code>. CORS (Cross Origin Resource Sharing) 에러가 뜬다.</li>\n<li><code class=\"language-text\">문제 2</code>. 이용자에게 카카오맵 API 주소가 노출되는 문제가 발생한다.</li>\n</ul>\n<p>이를 해결하기 위해서 별도의 프록시 서버를 구축해야 했다.</p>\n<p>처음에는 <code class=\"language-text\">cors-anywhere</code>라는 repo를 fork하여 Heroku에서 서버를 돌렸다. 이러한 방식을 사용하면, 단순히 <a href=\"https://subway-live-ef069a488429.herokuapp.com/\">https://subway-live-ef069a488429.herokuapp.com/</a> 뒤에 요청할 API 링크를 붙이기만 하면 되기 때문이다. 하지만 이 방법은 <code class=\"language-text\">문제 1</code>은 해결할 수 있지만, <code class=\"language-text\">문제 2</code>는 해결할 수 없었다. 따라서 직접 프록시 서버를 구축하기로 하였다.</p>\n<h3 id=\"2-2-express로-간단한-서버-만들기\" style=\"position:relative;\"><a href=\"#2-2-express%EB%A1%9C-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%84%9C%EB%B2%84-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"2 2 express로 간단한 서버 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-2. Express로 간단한 서버 만들기</h3>\n<ol>\n<li>초기설정을 해준다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">mkdir</span> subway-live-proxy\n<span class=\"token builtin class-name\">cd</span> subway-live-proxy\n<span class=\"token function\">npm</span> init <span class=\"token parameter variable\">-y</span>\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> express http-proxy-middleware cors</code></pre></div>\n<ol start=\"2\">\n<li><code class=\"language-text\">http-proxy-middleware</code>라는 npm 라이브러리를 사용하여, 서버 도메인명 뒤에 <code class=\"language-text\">/subway</code>가 오면 <a href=\"https://api.kakao.com/subway\">https://api.kakao.com/subway</a> 로 연결하는 간단한 JS 코드를 작성하였다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"express\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createProxyMiddleware <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http-proxy-middleware\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> cors <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cors\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"/subway\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">createProxyMiddleware</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://api.kakao.com/subway\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">changeOrigin</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Server is running on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">PORT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol>\n<li>이 서버로 향하는 CORS 문제를 해결하기 위해 <a href=\"https://leesj.me%EB%A5%BC\">https://leesj.me를</a> 허용하였다. 개발 서버로 사용하는 localhost도 허용하였다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> allowedOrigins <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"http://localhost:5173\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"http://localhost:5174\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"https://leesj.me\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> corsOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">origin</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">origin<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>allowedOrigins<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>origin<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>origin<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Not allowed by CORS\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">credentials</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">cors</span><span class=\"token punctuation\">(</span>corsOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"4\">\n<li><code class=\"language-text\">subway-live-proxy</code>라는 비공개 repo에 해당 파일을 넣어 Heroku에 호스트하였다. 자세한 방법은 <a href=\"https://devcenter.heroku.com/articles/git\">Docs</a>를 참고하면 된다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">heroku login\nheroku create subway-live-proxy\n<span class=\"token function\">git</span> push heroku master</code></pre></div>\n<h3 id=\"2-3-프록시-서버-도메인-설정\" style=\"position:relative;\"><a href=\"#2-3-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%84%9C%EB%B2%84-%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%84%A4%EC%A0%95\" aria-label=\"2 3 프록시 서버 도메인 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-3. 프록시 서버 도메인 설정</h3>\n<p>Heroku에서 기본적으로 제공하는 도메인명은 너무 길고 예쁘지가 않아 직접 도메인을 따로 설정하였다.</p>\n<ol>\n<li>\n<p>Heroku 앱의 <code class=\"language-text\">Settings > Domains</code>에서 <code class=\"language-text\">Add domain</code>을 누르고 도메인명에 <code class=\"language-text\">api.leesj.me</code>를 입력하였다. 그러면 Heroku에서 제시한 DNS Target이 나타난다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.925925925925924%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAArElEQVR42p2PQQ/CIAyF+f//TM87myzRg4k6HRsF2vIsuLnEww6+5AVCH19bx6xIkaGqEFFoUawSkeZkGeIC2UpNpZR2Xs9PdIceYYpwIRDuwwsPnzF4AhF9wxRzc8yKkQRTiO09J2leeLicbuiOPWhKcDXQXCE/3f0cDJY/0zLjNXprkMB2F66TJxvAmuj202FHNVxXXtefQ2gbxBiRksEygZe6GrSCd4H/6A1pUom8HOTsmQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-4.png\"\n        title=\"\"\n        src=\"/static/60fe454d757983e16f310bc4f7adeb5b/b4ad3/2-4.png\"\n        srcset=\"/static/60fe454d757983e16f310bc4f7adeb5b/8c112/2-4.png 270w,\n/static/60fe454d757983e16f310bc4f7adeb5b/03ec9/2-4.png 540w,\n/static/60fe454d757983e16f310bc4f7adeb5b/b4ad3/2-4.png 1080w,\n/static/60fe454d757983e16f310bc4f7adeb5b/399e3/2-4.png 1620w,\n/static/60fe454d757983e16f310bc4f7adeb5b/36aa2/2-4.png 2160w,\n/static/60fe454d757983e16f310bc4f7adeb5b/21db5/2-4.png 2584w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n<li>\n<p>도메인 관리 사이트에 들어가서 DNS target을 추가해주었다. 필자는 Namecheap에서 도메인을 구입하였는데, Namecheap의 <code class=\"language-text\">Domain List > Manage > Advanced DNS</code>에 들어가서 다음을 추가하였다.</p>\n<ul>\n<li><code class=\"language-text\">Type</code>: <code class=\"language-text\">CNAME Record</code></li>\n<li><code class=\"language-text\">Host</code>: <code class=\"language-text\">api</code></li>\n<li><code class=\"language-text\">Value</code>: Heroku에서 제시한 DNS Target</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABy0lEQVR42qVUy27bMBDU//9Jey76HzkUySVAXSSxrehBSRTFh6TpDCMZjpBLUQJj7nJ3h8Ml5eI89DiVJTpjMC8L/ncUvXOoSGathR1HOPpt26Lr++yX3ExzwzVDPNP/8fiIn09PeK1reOYrrvp5nlH4aULNgAiGYchkVxZVXDNdh8vlkudr+Y6K+PXygm8PD/hO/GbeRLKetUJKCYXY387nrEyjbQ1CjPAb1nXF8g+tKHqqOp3+UPKYF6qqyjvlQbJ1A+7wae0rQpFIso49Uql6sVKViCOx3pFkxQfcYiJMLB7YR8/CINAf6UfOOrLsRHL5R7gQPvkiL/QzMSAy2dpAqvSEZFsSTiSWf8S09Vl1jnnqfSGpUQUszv1hYr6EzXbe581w6KOgjVWrEZgXb4RStBPut7oReqpPX/RRca3vF/hBGEhIR+ffvxL9zluDczu4q45+HHtd3GIhxE3h0CGOQwafPVY3YnEWfLG0LXzPOD/PZAfMRJ6ZuzKebJ9jCLxU0yJ0hpdCQvd+xXB+RTANEv3QtXmOvYFra7imxthUed5t5YjEs8bTtlVJ8o6ElCsVU9vk7zIuOka6QcfdMd/Z9zH9H+g16Nn8BdllRWI+N1++AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-5.png\"\n        title=\"\"\n        src=\"/static/64ab9d7603dc93120edd921e01a24caf/b4ad3/2-5.png\"\n        srcset=\"/static/64ab9d7603dc93120edd921e01a24caf/8c112/2-5.png 270w,\n/static/64ab9d7603dc93120edd921e01a24caf/03ec9/2-5.png 540w,\n/static/64ab9d7603dc93120edd921e01a24caf/b4ad3/2-5.png 1080w,\n/static/64ab9d7603dc93120edd921e01a24caf/399e3/2-5.png 1620w,\n/static/64ab9d7603dc93120edd921e01a24caf/36aa2/2-5.png 2160w,\n/static/64ab9d7603dc93120edd921e01a24caf/8b6bd/2-5.png 2354w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n</ol>\n<ul>\n<li>정리하면 다음과 같다.\n<ul>\n<li>Frontend <code class=\"language-text\">subway-live</code> (공개 repo): Github Pages에서 <a href=\"https://leesj.me/subway-live\">https://leesj.me/subway-live</a> 로 호스팅</li>\n<li>Backend <code class=\"language-text\">subway-live-proxy</code> (비공개 repo): Heroku에서 <a href=\"https://api.leesj.me\">https://api.leesj.me</a> 로 호스팅</li>\n<li>요청 흐름도:</li>\n</ul>\n<a href=\"https://leesj.me/subway-live\">https://leesj.me/subway-live</a> -(클라이언트의 GET 요청)→\n<a href=\"https://api.leesj.me\">https://api.leesj.me</a> -(CNAME)→\n<a href=\"https://evening-sloth-jhbn33ojujdsv5niwwm98v92.herokudns.com\">https://evening-sloth-jhbn33ojujdsv5niwwm98v92.herokudns.com</a> -(서버의 GET 요청)→\n<a href=\"https://api.kakao.com/subway\">https://api.kakao.com/subway</a></li>\n</ul>\n<h3 id=\"2-4-ssl-인증-활성화\" style=\"position:relative;\"><a href=\"#2-4-ssl-%EC%9D%B8%EC%A6%9D-%ED%99%9C%EC%84%B1%ED%99%94\" aria-label=\"2 4 ssl 인증 활성화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-4. SSL 인증 활성화</h3>\n<p>여기까지 하면 프록시 서버는 http 형태의 주소가 된다. 그런데 https (클라이언트)에서 http (프록시 서버)로 요청을 보낼 수 없기 때문에 SSL 인증을 활성화해줘야 한다. 이 옵션은 원래 Heroku 유료 플랜을 사용하여야지만 활성화가 가능한데, 다행히도 <a href=\"https://github.com/edu/students\">Github Student Developer Pack</a>에 가입되어 있는 경우 $312의 크레딧을 제공해주어 무료로 사용이 가능했다.</p>\n<p>SSL 인증 활성화는 Terminal에서 Heroku CLI를 통해 간단하게 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">heroku certs:auto:enable <span class=\"token parameter variable\">-a</span> subway-live-proxy</code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#0-%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\">0. 들어가며</a></p>\n</li>\n<li>\n<p><a href=\"#1-%EC%B9%B4%EC%B9%B4%EC%98%A4%EB%A7%B5-%EB%82%B4%EB%B6%80-api-%EC%B0%BE%EC%95%84%EB%82%B4%EA%B8%B0\">1. 카카오맵 내부 API 찾아내기</a></p>\n<ul>\n<li><a href=\"#1-1-iphone-wi-fi-%EC%84%A4%EC%A0%95-%EB%B3%80%EA%B2%BD\">1-1. iPhone Wi-Fi 설정 변경</a></li>\n<li><a href=\"#1-2-iphone%EC%97%90-ssl-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%84%A4%EC%B9%98\">1-2. iPhone에 SSL 인증서 설치</a></li>\n<li><a href=\"#1-3-charles-%EC%8B%A4%ED%96%89\">1-3. Charles 실행</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#2-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%84%9C%EB%B2%84-%EA%B5%AC%EC%B6%95\">2. 프록시 서버 구축</a></p>\n<ul>\n<li><a href=\"#2-1-%EC%99%9C-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%84%9C%EB%B2%84%EA%B0%80-%ED%95%84%EC%9A%94%ED%95%9C%EA%B0%80\">2-1. 왜 프록시 서버가 필요한가?</a></li>\n<li><a href=\"#2-2-express%EB%A1%9C-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%84%9C%EB%B2%84-%EB%A7%8C%EB%93%A4%EA%B8%B0\">2-2. Express로 간단한 서버 만들기</a></li>\n<li><a href=\"#2-3-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%84%9C%EB%B2%84-%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%84%A4%EC%A0%95\">2-3. 프록시 서버 도메인 설정</a></li>\n<li><a href=\"#2-4-ssl-%EC%9D%B8%EC%A6%9D-%ED%99%9C%EC%84%B1%ED%99%94\">2-4. SSL 인증 활성화</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"June 21, 2024","title":"subway-live 작업기 2부. API 작업","categories":"웹개발","author":"이승준","emoji":"🚇"},"fields":{"slug":"/subway-live-2/"}},"prev":{"id":"a76c0a1f-62a6-5c84-b28d-15e38434a894","html":"<h1 id=\"1-무슨-현상인가\" style=\"position:relative;\"><a href=\"#1-%EB%AC%B4%EC%8A%A8-%ED%98%84%EC%83%81%EC%9D%B8%EA%B0%80\" aria-label=\"1 무슨 현상인가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 무슨 현상인가?</h1>\n<p>iOS 18 / MacOS 15에 새로 도입된 ‘iPhone Mirroring’이 갑자기 어느 순간부터 아이폰에서 작동되지 않았다. 아래 사진과 같이 Mac에서 iPhone Mirroing을 시도하면 **“An error occurred. Please try again.”**라는 메세지가 뜨며 <code class=\"language-text\">Try Again</code>을 아무리 눌러도 동일한 창이 뜬다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1036px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 194.44444444444446%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAnCAYAAAAPZ2gOAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC1klEQVR42u2Wz08TQRTHSyuGoFxIuGFsvHPm1l74DwyJNw4e/DOamJhookcTbz0qUYIHkRMJsRdaSUQjW6At/UXL9tfO/mjtbnfb53vrtm5xKUPhYIyTfPumM/M++2Zn5u34fK4CABORSMSPlkMRP431nVcIRvJdsoz0i0ajU1tbW3djsdg9HtFY8vnjCWQ3NzeDlYq4LTGpLUkNHa2B1lONRt1oSHUd621RFLfJd8DCnwD9OT5Ov8A6aJpqqaoCWlOjuqeo35FFPvl8/qkDDLiBb6lTVuQOY1IPbU+Wmaeo35bMTNPsQCaTeYMI/1CEyaSwbgNl2UQnUDACRZE9Rf2OrF6vCwcHwjtETLqBE7+BjBvICNgdAG8OAQVBeD8EdBxHRHc2wusEHvwHXgCUGK4oY1cHKuSE1tJbYOrN64mw1VRh7dNXWI99g6am0MYfH4gbF4yWDPdf7sCDVwnQWB3bFZy+dDEw6RmhDG2NwcPXKXi0mgZVqvEDhXOAPxD4+MMRPPmYApWNCSRYP02RzWczUCrmoYkprZ+6uIEIMzFxglgRbVWrFRCEfdjf/w6ieAqYhKFcLtnvlxuIGRlKpZOBCFqrVaFYLMDJSRFyuWx/2gi0+Kas4lRpigTY2/sCu7uf7ciozbUf+RdFdo4aRVYo5O2oqG5vp/FXmdkLQFG1Wk33YlztLPcB/1j6Sv5dEQocEfJ+Rs8DHh4mL/1dHh2h86Gnp/JOGTe41e1ankBfKnW0BtCjgQYO7OJJ6WLdU9TvqGNZJqTTR6vOVcQ/ACZ2dp5ThEbHsHS9DYahQ9+6RW0DGbp9+4rH489oljbQKZOhUGghsZvYKBQKp3g9K+P5RZs7JesWtf1StkxjE4n4xtJSaAEZN9w3Wf/c3NxttPMzMzOLwWAwPFrzpNDs7Owi+txxfIfv28vLy4FwOEzX22nULU5Nr6ysTJHvhZdwHtF7Owv4CWbh59lCWegnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"iphone-mirroring-1.png\"\n        title=\"\"\n        src=\"/static/911de65fd428b612fa5c53395cbc4379/4423c/iphone-mirroring-1.png\"\n        srcset=\"/static/911de65fd428b612fa5c53395cbc4379/8c112/iphone-mirroring-1.png 270w,\n/static/911de65fd428b612fa5c53395cbc4379/03ec9/iphone-mirroring-1.png 540w,\n/static/911de65fd428b612fa5c53395cbc4379/4423c/iphone-mirroring-1.png 1036w\"\n        sizes=\"(max-width: 1036px) 100vw, 1036px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">iPhone Mirroring > Settings > Reset iPhone Access</code>를 해봐도 **“Unable to Reset iPhone Access”**가 뜨면서 실패한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.074074074074076%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACGElEQVR42n2SXWvTUBjH66o3XhfWxCRNmpeTVGtae+NALNjlJG3R+QKrlk2xbdatQ73cZxAG24VXIl4IeiOIX2UUNljvd7OP0Jw8Pid9WZXigR/n5X/OL89JkkpNWhq5KQjCHD6f8b+1hSydmjVCSKdUKo1s2z7RNG2o6/rQNM1hoVAYFovFIXGcBNd1kzWeGYYx4wQZ4bnOXCjLyqHtFMAwrSivG7yHR7Ua+L4PlFJotzYTKM79IEgyLa+DklMhp2oRH9+S5cO5MJsVj3TDBGLbYxQzYjvMo5QF9ToLGg327ctX9vHTZ9ZsNpiPax71GIoYCnk/VrU8cMeVUBSPMQCsLjItAqZlwbrngYdQ6kHr9Vt4vvUmGa97NMl4VVOiRIiOv4Q8tIgdYXW8BxrUoT/Yh+7OLnR7IXS7Pej196Ab9pOMX1dWcrxfKjyavA8Vy9cYbmC0Vo3bL5rxdmsjHoTb8W6nHW9tPo5bT/2YZ6qmMxTya4/57f65snRcdF0olcvRXbcM7m0Cay8PgOz9AhL+gMq7n3APIeF3sAe/4X7rAPI5ERRVB3x4ZDsOiJJ0VWEmk3mPX/pcVtRTSVHPFFkYFR9uXJD6h0viDy6dgLOfjPnanQdPLoRsZrSaFc8EQTyVJPmcO2a+FWQVqSBrU6r4lz7D4NUyeMb3LOyvTB0rM+m16SQ9p1q9nqrs3FgKzxb3Ts5yR+oPekDp5izv7ycAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"iphone-mirroring-2.png\"\n        title=\"\"\n        src=\"/static/ff1384d336b46b79fde832db26130d29/b4ad3/iphone-mirroring-2.png\"\n        srcset=\"/static/ff1384d336b46b79fde832db26130d29/8c112/iphone-mirroring-2.png 270w,\n/static/ff1384d336b46b79fde832db26130d29/03ec9/iphone-mirroring-2.png 540w,\n/static/ff1384d336b46b79fde832db26130d29/b4ad3/iphone-mirroring-2.png 1080w,\n/static/ff1384d336b46b79fde832db26130d29/bb51b/iphone-mirroring-2.png 1320w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>일반적인 다른 버그가 발생했을 때와 마찬가지로 먼저 시도해본 조치는</p>\n<ul>\n<li>Mac에서 iPhone Mirroring 재실행</li>\n<li>WiFi, Bluetooth 껐다 켜기</li>\n<li>Mac, iPhone 재부팅</li>\n</ul>\n<p>이었다. 그럼에도 불구하고 이 현상을 해결하지 못하였다. 그래서 필자와 동일한 현상을 겪고 있는 사람이 없는지 검색해보았다.</p>\n<h1 id=\"2-공론화\" style=\"position:relative;\"><a href=\"#2-%EA%B3%B5%EB%A1%A0%ED%99%94\" aria-label=\"2 공론화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 공론화</h1>\n<p>국내 커뮤니티에서는 <a href=\"https://cafe.naver.com/inmacbook/2716116\">맥쓰사의 이 글</a>을 제외하면 아직까지 보고된 바가 거의 없으며, Reddit, Apple Support, MacRumors 등 해외 포럼에서 일부 보고되었다.</p>\n<p><a href=\"https://www.reddit.com/r/MacOS/comments/1fig94k/macos_15_iphone_mirroring_not_working/\">Reddit의 이 글</a>의 댓글을 읽어보면 자신도 동일한 현상을 겪고 있다고 호소하는 사람도 있었고, <a href=\"https://www.reddit.com/r/MacOS/comments/1fictxd/iphone_mirroring_not_working/\">Reddit의 다른 글</a>에서는 200회(…) 정도 앱을 재실행하니 해결되었다고 하는 사람도 있었다.</p>\n<h1 id=\"3-해결-방안\" style=\"position:relative;\"><a href=\"#3-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EC%95%88\" aria-label=\"3 해결 방안 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 해결 방안</h1>\n<p>아래의 체크리스트를 순서대로 읽어보면서 해결 방안을 찾아보자.</p>\n<h2 id=\"3-1-요구-사항-확인\" style=\"position:relative;\"><a href=\"#3-1-%EC%9A%94%EA%B5%AC-%EC%82%AC%ED%95%AD-%ED%99%95%EC%9D%B8\" aria-label=\"3 1 요구 사항 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3-1. 요구 사항 확인</h2>\n<p><a href=\"https://support.apple.com/ko-kr/120421\">Apple의 공식 문서</a>를 다시 한번 읽어보며 iPhone Mirroring을 사용하기 위한 전제 조건을 만족했는지 확인해보자.</p>\n<ul>\n<li>컴퓨터가 Apple Silicon이 탑재된 Mac 또는 Apple T2 보안 칩이 탑재된 Mac이며 macOS Sequoia 15 및 이후 버전을 사용하고 있습니다.</li>\n<li>iPhone이 iOS 18 및 이후 버전을 사용하고 있습니다.</li>\n<li>iPhone과 Mac이 이중 인증을 사용하는 동일한 Apple 계정에 로그인되어 있습니다.</li>\n<li>iPhone과 Mac에 Bluetooth 및 Wi-Fi가 켜져 있습니다.</li>\n<li>iPhone이 잠겨 있고 Mac 근처에 있습니다. 충전 중이거나 스탠바이를 사용 중이어도 됩니다.</li>\n<li>iPhone이 셀룰러 연결을 공유하고 있지 않습니다(개인용 핫스팟을 사용하고 있지 않음).</li>\n<li>Mac이 인터넷 연결을 공유하고 있지 않으며 AirPlay 또는 Sidecar를 사용하고 있지 않습니다.</li>\n</ul>\n<h2 id=\"3-2-vpn--dns-등-네트워크-설정-확인\" style=\"position:relative;\"><a href=\"#3-2-vpn--dns-%EB%93%B1-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%84%A4%EC%A0%95-%ED%99%95%EC%9D%B8\" aria-label=\"3 2 vpn  dns 등 네트워크 설정 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3-2. VPN / DNS 등 네트워크 설정 확인</h2>\n<p>우선 필자의 경우에는 해당되지 않았지만 Mac, iPhone, 내지는 WiFi 라우터 측에서 VPN을 설정하지 않았는지 확인해볼 필요가 있다. VPN을 사용하고 있다면 VPN을 끄고 다시 시도해보자. 또 DNS를 수동으로 설정하고 있거나, 프록시 세팅을 해놓은 게 있다면 이를 해제하고 다시 시도해보자. 특히 <a href=\"https://forums.macrumors.com/threads/iphone-mirroring-not-working.2436525/\">MacRumors의 이 글</a>의 댓글에서는 Cloudflare사의 DNS 대신 ISP DNS를 사용하니 해결되었다는 사례가 있다.</p>\n<h2 id=\"3-3-iphone을-맞게-선택했는지-확인\" style=\"position:relative;\"><a href=\"#3-3-iphone%EC%9D%84-%EB%A7%9E%EA%B2%8C-%EC%84%A0%ED%83%9D%ED%96%88%EB%8A%94%EC%A7%80-%ED%99%95%EC%9D%B8\" aria-label=\"3 3 iphone을 맞게 선택했는지 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3-3. iPhone을 맞게 선택했는지 확인</h2>\n<p>또 복수의 iPhone을 사용하는 경우, Mac의 <code class=\"language-text\">System Preferences > Desktop &amp; Dock > Widgets</code>에서 사용할 iPhone이 맞게 선택되었는지 확인한다.</p>\n<h2 id=\"3-4-기본적인-조치들\" style=\"position:relative;\"><a href=\"#3-4-%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9D%B8-%EC%A1%B0%EC%B9%98%EB%93%A4\" aria-label=\"3 4 기본적인 조치들 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3-4. 기본적인 조치들</h2>\n<p><strong>1</strong>에서 언급한 아래 세 가지를 반복적으로 시도해보자.</p>\n<ul>\n<li>Mac에서 iPhone Mirroring 재실행</li>\n<li>WiFi, Bluetooth 껐다 켜기</li>\n<li>Mac, iPhone 재부팅</li>\n</ul>\n<h2 id=\"3-5-iphone에서-mac-권한-삭제\" style=\"position:relative;\"><a href=\"#3-5-iphone%EC%97%90%EC%84%9C-mac-%EA%B6%8C%ED%95%9C-%EC%82%AD%EC%A0%9C\" aria-label=\"3 5 iphone에서 mac 권한 삭제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3-5. iPhone에서 Mac 권한 삭제</h2>\n<p>iPhone 설정에서 <code class=\"language-text\">General > AirPlay &amp; Continuity > iPhone Mirroring</code>으로 들어가서 Mac의 권한을 삭제한 뒤 다시 시도해보자.</p>\n<h2 id=\"3-6-apple-계정-로그아웃-후-재로그인\" style=\"position:relative;\"><a href=\"#3-6-apple-%EA%B3%84%EC%A0%95-%EB%A1%9C%EA%B7%B8%EC%95%84%EC%9B%83-%ED%9B%84-%EC%9E%AC%EB%A1%9C%EA%B7%B8%EC%9D%B8\" aria-label=\"3 6 apple 계정 로그아웃 후 재로그인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3-6. Apple 계정 로그아웃 후 재로그인</h2>\n<p>Mac과 iPhone 모두에서 <strong>Apple 계정을 로그아웃하고 다시 로그인</strong>하는 방법이 필자에게는 유효하게 작용하였다. (이때 Mac에서 로그아웃할 때는 <code class=\"language-text\">Apple menu > Log Out</code>이 아니라 <code class=\"language-text\">System Preferences > Apple Account > Sign Out</code>을 해야 한다.) 이후 Apple 계정에 다시 로그인한 뒤, 두 기기를 모두 재시작한다.</p>\n<h2 id=\"3-7-terminal을-이용하여-iphone-id-삭제\" style=\"position:relative;\"><a href=\"#3-7-terminal%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-iphone-id-%EC%82%AD%EC%A0%9C\" aria-label=\"3 7 terminal을 이용하여 iphone id 삭제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3-7. Terminal을 이용하여 iPhone ID 삭제</h2>\n<p>그럼에도 안 된다면 Terminal을 이용하여 Continuity에 등록된 iPhone ID를 삭제하는 방법이 있다. 이 방법은 <a href=\"https://www.reddit.com/r/MacOSBeta/comments/1f55455/potential_fix_for_iphone_mirroring_not_working_on/\">Reddit의 이 글</a>에서 소개되었다.</p>\n<ol>\n<li>Terminal에 <code class=\"language-text\">defaults export com.apple.ScreenContinuity ~/Desktop/ScreenContinuityDefaults.plist</code>을 입력하여 <code class=\"language-text\">ScreenContinuityDefaults.plist</code>을 임시로 Desktop에 백업한다.</li>\n<li>Terminal에 <code class=\"language-text\">defaults delete com.apple.ScreenContinuity onenessPairedDeviceID</code>를 입력하여 Continuity에 등록된 iPhone ID(<code class=\"language-text\">onenessPairedDeviceID</code>)를 삭제한다.</li>\n<li>Mac을 재시작한 뒤 iPhone Mirroring 앱을 다시 켠다.</li>\n<li>혹시나 문제가 발생하면 <code class=\"language-text\">defaults import com.apple.ScreenContinuity ~/Desktop/ScreenContinuityDefaults.plist</code>를 입력하여 원래대로 돌려놓는다.</li>\n</ol>\n<h2 id=\"3-8-초기화\" style=\"position:relative;\"><a href=\"#3-8-%EC%B4%88%EA%B8%B0%ED%99%94\" aria-label=\"3 8 초기화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3-8. 초기화</h2>\n<p>최후의 방안은 (당연하게도) Mac과 iPhone을 백업한 후 모두 초기화하는 것이다. 필자의 경우에는 그 전에 문제가 해결되었기에 여기까지 오지는 않았다. 사실 백업-초기화-복원을 하는 일련의 과정은 꽤나 골치 아픈 일이기 때문에, 위에서 언급한 방법들을 <strong>반복적으로</strong> 시도해본 뒤 정 안 되면 초기화하는 것이 좋다. 필자의 경우에도 Apple 계정 재로그인 이후, 재부팅과 iPhone Mirroring 앱 재실행을 <strong>여러 번 반복</strong>한 뒤에야 문제가 해결되었다.</p>\n<h2 id=\"4-맺으며\" style=\"position:relative;\"><a href=\"#4-%EB%A7%BA%EC%9C%BC%EB%A9%B0\" aria-label=\"4 맺으며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 맺으며</h2>\n<p>Apple의 OS가 날이 갈수록 불안정해지고 있다는 느낌을 점점 받는다. 특히 iOS 14~15 정도부터 간헐적으로 버그들이 나타나더니 17과 18에서는 하루에 버그가 아예 나타나지 않는 날이 없을 정도로 그 정점을 찍고 있다. 이번 iPhone Mirroring 먹통 현상도 그 중 하나로, 이 현상을 겪는 유저들이 많진 않은 것으로 보이지만 해당 현상이 나타나는 유저들에게는 상당한 짜증을 안겨준다. Apple의 OS 엔지니어들이 이 글을 읽지는 않겠지만, 정식 버전을 릴리즈하기 전에 베타에서 모든 문제들을 해결하고 배포해달라는 것을 당부하고 싶다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#3-1-%EC%9A%94%EA%B5%AC-%EC%82%AC%ED%95%AD-%ED%99%95%EC%9D%B8\">3-1. 요구 사항 확인</a></li>\n<li><a href=\"#3-2-vpn--dns-%EB%93%B1-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%84%A4%EC%A0%95-%ED%99%95%EC%9D%B8\">3-2. VPN / DNS 등 네트워크 설정 확인</a></li>\n<li><a href=\"#3-3-iphone%EC%9D%84-%EB%A7%9E%EA%B2%8C-%EC%84%A0%ED%83%9D%ED%96%88%EB%8A%94%EC%A7%80-%ED%99%95%EC%9D%B8\">3-3. iPhone을 맞게 선택했는지 확인</a></li>\n<li><a href=\"#3-4-%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9D%B8-%EC%A1%B0%EC%B9%98%EB%93%A4\">3-4. 기본적인 조치들</a></li>\n<li><a href=\"#3-5-iphone%EC%97%90%EC%84%9C-mac-%EA%B6%8C%ED%95%9C-%EC%82%AD%EC%A0%9C\">3-5. iPhone에서 Mac 권한 삭제</a></li>\n<li><a href=\"#3-6-apple-%EA%B3%84%EC%A0%95-%EB%A1%9C%EA%B7%B8%EC%95%84%EC%9B%83-%ED%9B%84-%EC%9E%AC%EB%A1%9C%EA%B7%B8%EC%9D%B8\">3-6. Apple 계정 로그아웃 후 재로그인</a></li>\n<li><a href=\"#3-7-terminal%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-iphone-id-%EC%82%AD%EC%A0%9C\">3-7. Terminal을 이용하여 iPhone ID 삭제</a></li>\n<li><a href=\"#3-8-%EC%B4%88%EA%B8%B0%ED%99%94\">3-8. 초기화</a></li>\n<li><a href=\"#4-%EB%A7%BA%EC%9C%BC%EB%A9%B0\">4. 맺으며</a></li>\n</ul>\n</div>","frontmatter":{"date":"October 12, 2024","title":"iPhone 미러링 먹통 해결방법","categories":"iOS","author":"이승준","emoji":"📱"},"fields":{"slug":"/iphone-mirroring/"}},"site":{"siteMetadata":{"siteUrl":"https://leesj.me","comments":{"utterances":{"repo":"leesj-dev/leesj-dev.github.io"}}}}},"pageContext":{"slug":"/subway-live-3/","nextSlug":"/subway-live-2/","prevSlug":"/iphone-mirroring/"}},"staticQueryHashes":["1073350324","2009502679","2938748437"],"slicesMap":{}}