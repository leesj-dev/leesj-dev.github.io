{"componentChunkName":"component---src-templates-blog-template-js","path":"/subway-live-2/","result":{"data":{"cur":{"id":"bf631c6c-59c8-557f-bc71-09c6bd2fa33c","html":"<h2 id=\"0-들어가며\" style=\"position:relative;\"><a href=\"#0-%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\" aria-label=\"0 들어가며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0. 들어가며</h2>\n<p>부산 지하철 실시간 도착정보 서비스를 만들기 위해 가장 먼저 준비해야 하는 것은 그 <strong>실시간 도착정보를 가져오는 것</strong>이다. <a href=\"https://data.go.kr\">공공데이터포털</a>, <a href=\"https://data.kric.go.kr\">레일포털</a>, <a href=\"https://apis.map.kakao.com/web/\">카카오맵 API</a> 등을 모두 찾아 보았으나, OpenAPI 형태로 실시간 도착정보를 제공하는 곳은 없었다. 어쩔 수 없이 카카오맵 앱 내부적으로 사용되는 API를 사용하여 실시간 도착정보를 찾아내기로 했다. 이 내부 API는 외부에 공개되지 않기 때문에 네트워크 패킷을 분석하여 찾아내야 한다.</p>\n<h2 id=\"1-카카오맵-내부-api-찾아내기\" style=\"position:relative;\"><a href=\"#1-%EC%B9%B4%EC%B9%B4%EC%98%A4%EB%A7%B5-%EB%82%B4%EB%B6%80-api-%EC%B0%BE%EC%95%84%EB%82%B4%EA%B8%B0\" aria-label=\"1 카카오맵 내부 api 찾아내기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 카카오맵 내부 API 찾아내기</h2>\n<p>휴대폰에서 통신되는 네트워크 패킷을 컴퓨터에서 찾아낼 수 있는 소프트웨어를 검색해보니 <a href=\"https://www.charlesproxy.com/download/\">Charles Proxy</a>가 있었다. 30일 무료 평가판에 세션 시간 제한 등 제약이 있었지만, 카카오맵 내부 API를 찾아내는 데에는 문제가 없어 보였다. Charles Proxy를 Mac에 설치한 뒤 iPhone에서 몇 가지 설정을 만져 주었다.</p>\n<h3 id=\"1-1-iphone-wi-fi-설정-변경\" style=\"position:relative;\"><a href=\"#1-1-iphone-wi-fi-%EC%84%A4%EC%A0%95-%EB%B3%80%EA%B2%BD\" aria-label=\"1 1 iphone wi fi 설정 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-1. iPhone Wi-Fi 설정 변경</h3>\n<p>iPhone을 컴퓨터와 동일한 Wi-Fi 네트워크에 연결하고, <code class=\"language-text\">Settings > Wi-Fi > 해당 네트워크 옆 🛈</code>을 누르고 맨 밑으로 내려 <code class=\"language-text\">Configure Proxy</code>를 <code class=\"language-text\">Manual</code>로 바꿔주었다. Server는 컴퓨터의 IP 주소, Port는 <code class=\"language-text\">8888</code>로 설정하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 216.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAIAAAD3xz8iAAAACXBIWXMAAAsTAAALEwEAmpwYAAACeUlEQVR42u1W627aMBjN+z9GpT1Eq5V2g6oITas2Ki4JZMC4BEIuxPckkB3HjCFGU7SfE9bB+hznfPcYW0kigOUynE691Soyy7OIYxaGiecFtu1CxhMLP0LVt++dh4f642MjCBJC5GbDDzA0StN2u+s4P15e2jc3H3w/plRZJBGUCMEUZykhSusikvOMsRQzOHgJgtGIGUshcgjasj2XX0ay5cqfK0ETDi9ms1Wj0by9/VivN1utr5CfnprzuQ+acQTRIUy4Y/mhWKzF1BdBLIiOTUYRnUwW4/HcdSeet14ug9FoZsI5BB9FBIosQsDhlEAlIhQAtuEzHGYM3ioASyg1u+YFA50wITMpMyFSKfcQAoEdZi0ctspdDVi1pMzDMBwMBkVR7Ha74uJBqbQYU3meK6UM+ZKBFwFNFiJLkmQ8Hs9mM0JItX2zEfFCZgVn0uIciWFgLhYe5xx72+222mwsdirfMVa6nWVoBj3iOL7E/1O3+/0+coYZXrybud0hYSgVPE9T5EwDNeBcnQV8PMbvD4PIsntkHJuPQZwF2hPdUvaP2vd2uWZxvMFcmaoiSQg6IioH5+hCpWNGnmzbHg6HIFeEGgQBKjrFd+95SBOC1dkGB31yWXsUKI0QAgxtGe0Jlb1ez3SI8fysZeOX67rN5nMQrOGytnyiu9o4fERtIOzrvNlsut3u62vbcZxut4eCvxV8GWDm+76USscMBZAIoUgmITjWKOQ0RWj538BzzlEkqlS6bxIApTtGxRlq+uLPYfDPuJKv5Cv5vyYf36NO7lTvk8196QSHo+dNMtTjytXpOHd3tVrt8/39JwAClp2OjT+mE/u/AA9Vm+61LKuyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-1.png\"\n        title=\"\"\n        src=\"/static/e3c19cea906a4bff6d613557b6f64a7e/b4ad3/2-1.png\"\n        srcset=\"/static/e3c19cea906a4bff6d613557b6f64a7e/8c112/2-1.png 270w,\n/static/e3c19cea906a4bff6d613557b6f64a7e/03ec9/2-1.png 540w,\n/static/e3c19cea906a4bff6d613557b6f64a7e/b4ad3/2-1.png 1080w,\n/static/e3c19cea906a4bff6d613557b6f64a7e/c4688/2-1.png 1179w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"1-2-iphone에-ssl-인증서-설치\" style=\"position:relative;\"><a href=\"#1-2-iphone%EC%97%90-ssl-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%84%A4%EC%B9%98\" aria-label=\"1 2 iphone에 ssl 인증서 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-2. iPhone에 SSL 인증서 설치</h3>\n<p>iPhone의 Safari에서 <a href=\"https://chls.pro/ssl\">SSL 인증서</a>를 다운로드하여 설치하고, <code class=\"language-text\">Settings > General > About > Certificate Trust Settings > Enable Full Trust for Root Certificates</code> 경로로 가서 Charles Proxy의 인증서를 활성화하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 216.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAIAAAD3xz8iAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC7UlEQVR42u1W204bMRDND/e139C3fgJSPwPEpS0CBEhQSiOFhFz26t14vd6L7d21Az32hoirkCr1jWEymhn7xJ7jcfCgLBU0SVgQJHFMi0L2mZfKuWCsJCQbjaZ5XldVM7ADVXP568/BweHl5TWywD9TwOq6vboajsezi4vfW1vf0jRHZlCVqi6VEq2UnRBQ7axVDD/4WkqrWA1JpUy/l8Eoaq795nTajKKWUn50dLq7+31//+fx8dn5+eXJyfnZ2cXOzh6Sh4cnWBD4TWmDlClCpZfImErGKs+LfZ/M5+FiEWEqwjBMYRHe3nqYAExfiwXXlWpUq7uV1tA7Y6Cr1eoeoVK6bVdta2C7boU8fCSbBrazYFcJFrQym82SJIEznU6zLLt/JFrrLGN5nhdFgaG2BR3tAB9jDGLOubMFY4wQgm8E5u5BMEcIJYQErMHSRlswSFYKHBSYzZ3kThDePZXNFupaaG3WYCnlYrEIw3A+n/u+1ztxHN+/Jl3XMpavt426gQcl2AtY6W0fuu99ogCIdUe0ljCcG6VlEKRxnKH10pRH0ZIQlM2iiCZJDscNWUtp4foUPSd7MGhoyhJdWdc1fJy+4LxCyFiR5+WDVrAYcos3WNyC0WsgeTIZo8jJZIJqwzC4f0PQAdpo5o4KeEsYqAfboK1ygg1s6N2QbH33ZzpD8wycb45KUUqXS4oTxi5QVrpc8qLIOUcmQumU2saom7BJP4++3oiFMHINFqIOfW82nZA4JHEUR0EchZxly5QkCQk8W4jnexmhnoo/Db+MylmFhfsrmVdtzA0pVnFuotwQDrvyMzjaZyZgd6UwXWuk0spezzYteF03ju1SLZm9VUEq/VQunINw48yIxAT3kyC5u0xVCY7clbQBTqtWuF5Q0Wu9zvQ+Jrz6w2TBhdOXTvEo8yb4n/UD/AH+AH+A/wv45VNq8wh5H9y/l54pku+A3T8sPRyOt7f39vZ+4PkEhYNwOLzBg+zZ+n8BVzeDZAJWhnMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-2.png\"\n        title=\"\"\n        src=\"/static/dc76bda02ce5af533be44677ecfb63d0/b4ad3/2-2.png\"\n        srcset=\"/static/dc76bda02ce5af533be44677ecfb63d0/8c112/2-2.png 270w,\n/static/dc76bda02ce5af533be44677ecfb63d0/03ec9/2-2.png 540w,\n/static/dc76bda02ce5af533be44677ecfb63d0/b4ad3/2-2.png 1080w,\n/static/dc76bda02ce5af533be44677ecfb63d0/c4688/2-2.png 1179w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"1-3-charles-실행\" style=\"position:relative;\"><a href=\"#1-3-charles-%EC%8B%A4%ED%96%89\" aria-label=\"1 3 charles 실행 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-3. Charles 실행</h3>\n<p>카카오맵 앱에서 길찾기를 누르고 지하철이 포함된 동선으로 경로를 검색하면 Charles에서 요청을 보내는 링크를 확인할 수 있다. 외부에 공개된 API가 아니기 때문에 실제 링크 대신 가칭인 <code class=\"language-text\">https://api.kakao.com/subway</code>로 대체하였다.</p>\n<ul>\n<li>특정 역에서의 실시간 도착정보: <code class=\"language-text\">https://api.kakao.com/subway/station/arrivals.json?id=${stationID}</code></li>\n<li>특정 역의 시간표: <code class=\"language-text\">https://api.kakao.com/subway/station/timetable.json?id=${stationID}</code></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.4074074074074%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACtklEQVR42qVUy07bQBTNF/AR7U8QdigbvgF2LJDYZIHEgg9i0cYIwQKQWNAq6sM0DzmPQl5NYichxHawHb89M7d3Jk4XCFAlRjqa8dy5Z859jDPX0vGHcqn4udZsntSbzYKi1CRFUaSaUpUatZpUrValYrEoffn2XSrhulJTpAq3oy1FAXGCPp8uLi4+Zq4vL7Pd9m+m9bugP45Z6NkQehZYcx1Gqgp3d3cwnU7hUTcROuhzE+aWBbZlg23bYFkWWywWYBgGvbq62sjc/FTWv94bSVEZ0pbmJEODkL6eED8Gwighw+GQzGYz4rkuCcOQRIjA94nneQK+7ycIiqTx+fl5NnN8KWdv7l0md1341XWY3LbhR8uGmRWA7y1gPJkIJegESACu5wIhBBhjQCnlYIAjCAJ6enq6kSmXy9kkScQmjtUMcRyDaZqgYtjj8RhGo5EA30Ol/0hXPri3JJTlcjaKE2EiFBi/Dy9GwgQcxxEkPIc8T1whV+q6rlCNqiCKIoaC+Nm3FXIFeBg0TYPBoA86FoSrm8/nvBACfI1EjJ/lhIVC4XVCrm7+ZIGqjaDV7ohqNxoN6HQ6eMFAAAsG/X6fpelYVvk1QhsVGA8aWPoUMQEnDZGDh70CpoHxmSu8vb19nRBbBujTBOLZH4gMdZncl4cwIAetVCpv5DAOIdJViB0TEl7VdxFizUXVHR3C2QBiUwMa+e8npKEL0UMH/MceEHySz4J4mbBUKq1jt5PUSMUB7H7sRZb4CxbpQxYYKiOBy1Ln56ApIRGEsixneXM+v54/q5VarMhy/p+Qz87O1tvtNk2fF+Ovgjcx9hfgPvR6PdF7rVZLgK/xlwboLGzYj4z3ZL1ep+LnsLOzs7a/v7+5t7eX293dzeXz+dzh4eGbODo6Elh9Hxwc5La3tze3trbW/gLUR7ZtmLE17AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-3.png\"\n        title=\"\"\n        src=\"/static/f87433f6ea2c314b9e854e67b5ddf7e5/b4ad3/2-3.png\"\n        srcset=\"/static/f87433f6ea2c314b9e854e67b5ddf7e5/8c112/2-3.png 270w,\n/static/f87433f6ea2c314b9e854e67b5ddf7e5/03ec9/2-3.png 540w,\n/static/f87433f6ea2c314b9e854e67b5ddf7e5/b4ad3/2-3.png 1080w,\n/static/f87433f6ea2c314b9e854e67b5ddf7e5/399e3/2-3.png 1620w,\n/static/f87433f6ea2c314b9e854e67b5ddf7e5/36aa2/2-3.png 2160w,\n/static/f87433f6ea2c314b9e854e67b5ddf7e5/a7fe5/2-3.png 2606w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"2-프록시-서버-구축\" style=\"position:relative;\"><a href=\"#2-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%84%9C%EB%B2%84-%EA%B5%AC%EC%B6%95\" aria-label=\"2 프록시 서버 구축 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 프록시 서버 구축</h2>\n<h3 id=\"2-1-왜-프록시-서버가-필요한가\" style=\"position:relative;\"><a href=\"#2-1-%EC%99%9C-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%84%9C%EB%B2%84%EA%B0%80-%ED%95%84%EC%9A%94%ED%95%9C%EA%B0%80\" aria-label=\"2 1 왜 프록시 서버가 필요한가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-1. 왜 프록시 서버가 필요한가?</h3>\n<p>프론트엔드에서 해당 API를 바로 불러오면 두 가지 문제점이 발생한다.</p>\n<ul>\n<li><code class=\"language-text\">문제 1</code>. CORS (Cross Origin Resource Sharing) 에러가 뜬다.</li>\n<li><code class=\"language-text\">문제 2</code>. 이용자에게 카카오맵 API 주소가 노출되는 문제가 발생한다.</li>\n</ul>\n<p>이를 해결하기 위해서 별도의 프록시 서버를 구축해야 했다.</p>\n<p>처음에는 <code class=\"language-text\">cors-anywhere</code>라는 repo를 fork하여 Heroku에서 서버를 돌렸다. 이러한 방식을 사용하면, 단순히 <a href=\"https://subway-live-ef069a488429.herokuapp.com/\">https://subway-live-ef069a488429.herokuapp.com/</a> 뒤에 요청할 API 링크를 붙이기만 하면 되기 때문이다. 하지만 이 방법은 <code class=\"language-text\">문제 1</code>은 해결할 수 있지만, <code class=\"language-text\">문제 2</code>는 해결할 수 없었다. 따라서 직접 프록시 서버를 구축하기로 하였다.</p>\n<h3 id=\"2-2-express로-간단한-서버-만들기\" style=\"position:relative;\"><a href=\"#2-2-express%EB%A1%9C-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%84%9C%EB%B2%84-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"2 2 express로 간단한 서버 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-2. Express로 간단한 서버 만들기</h3>\n<ol>\n<li>초기설정을 해준다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">mkdir</span> subway-live-proxy\n<span class=\"token builtin class-name\">cd</span> subway-live-proxy\n<span class=\"token function\">npm</span> init <span class=\"token parameter variable\">-y</span>\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> express http-proxy-middleware cors</code></pre></div>\n<ol start=\"2\">\n<li><code class=\"language-text\">http-proxy-middleware</code>라는 npm 라이브러리를 사용하여, 서버 도메인명 뒤에 <code class=\"language-text\">/subway</code>가 오면 <a href=\"https://api.kakao.com/subway\">https://api.kakao.com/subway</a> 로 연결하는 간단한 JS 코드를 작성하였다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"express\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createProxyMiddleware <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http-proxy-middleware\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> cors <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cors\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"/subway\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">createProxyMiddleware</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://api.kakao.com/subway\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">changeOrigin</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Server is running on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">PORT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol>\n<li>이 서버로 향하는 CORS 문제를 해결하기 위해 <a href=\"https://leesj.me%EB%A5%BC\">https://leesj.me를</a> 허용하였다. 개발 서버로 사용하는 localhost도 허용하였다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> allowedOrigins <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"http://localhost:5173\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"http://localhost:5174\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"https://leesj.me\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> corsOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">origin</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">origin<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>allowedOrigins<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>origin<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>origin<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Not allowed by CORS\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">credentials</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">cors</span><span class=\"token punctuation\">(</span>corsOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"4\">\n<li><code class=\"language-text\">subway-live-proxy</code>라는 비공개 repo에 해당 파일을 넣어 Heroku에 호스트하였다. 자세한 방법은 <a href=\"https://devcenter.heroku.com/articles/git\">Docs</a>를 참고하면 된다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">heroku login\nheroku create subway-live-proxy\n<span class=\"token function\">git</span> push heroku master</code></pre></div>\n<h3 id=\"2-3-프록시-서버-도메인-설정\" style=\"position:relative;\"><a href=\"#2-3-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%84%9C%EB%B2%84-%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%84%A4%EC%A0%95\" aria-label=\"2 3 프록시 서버 도메인 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-3. 프록시 서버 도메인 설정</h3>\n<p>Heroku에서 기본적으로 제공하는 도메인명은 너무 길고 예쁘지가 않아 직접 도메인을 따로 설정하였다.</p>\n<ol>\n<li>\n<p>Heroku 앱의 <code class=\"language-text\">Settings > Domains</code>에서 <code class=\"language-text\">Add domain</code>을 누르고 도메인명에 <code class=\"language-text\">api.leesj.me</code>를 입력하였다. 그러면 Heroku에서 제시한 DNS Target이 나타난다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.925925925925924%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAArElEQVR42p2PQQ/CIAyF+f//TM87myzRg4k6HRsF2vIsuLnEww6+5AVCH19bx6xIkaGqEFFoUawSkeZkGeIC2UpNpZR2Xs9PdIceYYpwIRDuwwsPnzF4AhF9wxRzc8yKkQRTiO09J2leeLicbuiOPWhKcDXQXCE/3f0cDJY/0zLjNXprkMB2F66TJxvAmuj202FHNVxXXtefQ2gbxBiRksEygZe6GrSCd4H/6A1pUom8HOTsmQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-4.png\"\n        title=\"\"\n        src=\"/static/60fe454d757983e16f310bc4f7adeb5b/b4ad3/2-4.png\"\n        srcset=\"/static/60fe454d757983e16f310bc4f7adeb5b/8c112/2-4.png 270w,\n/static/60fe454d757983e16f310bc4f7adeb5b/03ec9/2-4.png 540w,\n/static/60fe454d757983e16f310bc4f7adeb5b/b4ad3/2-4.png 1080w,\n/static/60fe454d757983e16f310bc4f7adeb5b/399e3/2-4.png 1620w,\n/static/60fe454d757983e16f310bc4f7adeb5b/36aa2/2-4.png 2160w,\n/static/60fe454d757983e16f310bc4f7adeb5b/21db5/2-4.png 2584w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n<li>\n<p>도메인 관리 사이트에 들어가서 DNS target을 추가해주었다. 필자는 Namecheap에서 도메인을 구입하였는데, Namecheap의 <code class=\"language-text\">Domain List > Manage > Advanced DNS</code>에 들어가서 다음을 추가하였다.</p>\n<ul>\n<li><code class=\"language-text\">Type</code>: <code class=\"language-text\">CNAME Record</code></li>\n<li><code class=\"language-text\">Host</code>: <code class=\"language-text\">api</code></li>\n<li><code class=\"language-text\">Value</code>: Heroku에서 제시한 DNS Target</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABy0lEQVR42qVUy27bMBDU//9Jey76HzkUySVAXSSxrehBSRTFh6TpDCMZjpBLUQJj7nJ3h8Ml5eI89DiVJTpjMC8L/ncUvXOoSGathR1HOPpt26Lr++yX3ExzwzVDPNP/8fiIn09PeK1reOYrrvp5nlH4aULNgAiGYchkVxZVXDNdh8vlkudr+Y6K+PXygm8PD/hO/GbeRLKetUJKCYXY387nrEyjbQ1CjPAb1nXF8g+tKHqqOp3+UPKYF6qqyjvlQbJ1A+7wae0rQpFIso49Uql6sVKViCOx3pFkxQfcYiJMLB7YR8/CINAf6UfOOrLsRHL5R7gQPvkiL/QzMSAy2dpAqvSEZFsSTiSWf8S09Vl1jnnqfSGpUQUszv1hYr6EzXbe581w6KOgjVWrEZgXb4RStBPut7oReqpPX/RRca3vF/hBGEhIR+ffvxL9zluDczu4q45+HHtd3GIhxE3h0CGOQwafPVY3YnEWfLG0LXzPOD/PZAfMRJ6ZuzKebJ9jCLxU0yJ0hpdCQvd+xXB+RTANEv3QtXmOvYFra7imxthUed5t5YjEs8bTtlVJ8o6ElCsVU9vk7zIuOka6QcfdMd/Z9zH9H+g16Nn8BdllRWI+N1++AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-5.png\"\n        title=\"\"\n        src=\"/static/64ab9d7603dc93120edd921e01a24caf/b4ad3/2-5.png\"\n        srcset=\"/static/64ab9d7603dc93120edd921e01a24caf/8c112/2-5.png 270w,\n/static/64ab9d7603dc93120edd921e01a24caf/03ec9/2-5.png 540w,\n/static/64ab9d7603dc93120edd921e01a24caf/b4ad3/2-5.png 1080w,\n/static/64ab9d7603dc93120edd921e01a24caf/399e3/2-5.png 1620w,\n/static/64ab9d7603dc93120edd921e01a24caf/36aa2/2-5.png 2160w,\n/static/64ab9d7603dc93120edd921e01a24caf/8b6bd/2-5.png 2354w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n</ol>\n<ul>\n<li>정리하면 다음과 같다.\n<ul>\n<li>Frontend <code class=\"language-text\">subway-live</code> (공개 repo): Github Pages에서 <a href=\"https://leesj.me/subway-live\">https://leesj.me/subway-live</a> 로 호스팅</li>\n<li>Backend <code class=\"language-text\">subway-live-proxy</code> (비공개 repo): Heroku에서 <a href=\"https://api.leesj.me\">https://api.leesj.me</a> 로 호스팅</li>\n<li>요청 흐름도:</li>\n</ul>\n<a href=\"https://leesj.me/subway-live\">https://leesj.me/subway-live</a> -(클라이언트의 GET 요청)→\n<a href=\"https://api.leesj.me\">https://api.leesj.me</a> -(CNAME)→\n<a href=\"https://evening-sloth-jhbn33ojujdsv5niwwm98v92.herokudns.com\">https://evening-sloth-jhbn33ojujdsv5niwwm98v92.herokudns.com</a> -(서버의 GET 요청)→\n<a href=\"https://api.kakao.com/subway\">https://api.kakao.com/subway</a></li>\n</ul>\n<h3 id=\"2-4-ssl-인증-활성화\" style=\"position:relative;\"><a href=\"#2-4-ssl-%EC%9D%B8%EC%A6%9D-%ED%99%9C%EC%84%B1%ED%99%94\" aria-label=\"2 4 ssl 인증 활성화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-4. SSL 인증 활성화</h3>\n<p>여기까지 하면 프록시 서버는 http 형태의 주소가 된다. 그런데 https (클라이언트)에서 http (프록시 서버)로 요청을 보낼 수 없기 때문에 SSL 인증을 활성화해줘야 한다. 이 옵션은 원래 Heroku 유료 플랜을 사용하여야지만 활성화가 가능한데, 다행히도 <a href=\"https://github.com/edu/students\">Github Student Developer Pack</a>에 가입되어 있는 경우 $312의 크레딧을 제공해주어 무료로 사용이 가능했다.</p>\n<p>SSL 인증 활성화는 Terminal에서 Heroku CLI를 통해 간단하게 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">heroku certs:auto:enable <span class=\"token parameter variable\">-a</span> subway-live-proxy</code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#0-%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\">0. 들어가며</a></p>\n</li>\n<li>\n<p><a href=\"#1-%EC%B9%B4%EC%B9%B4%EC%98%A4%EB%A7%B5-%EB%82%B4%EB%B6%80-api-%EC%B0%BE%EC%95%84%EB%82%B4%EA%B8%B0\">1. 카카오맵 내부 API 찾아내기</a></p>\n<ul>\n<li><a href=\"#1-1-iphone-wi-fi-%EC%84%A4%EC%A0%95-%EB%B3%80%EA%B2%BD\">1-1. iPhone Wi-Fi 설정 변경</a></li>\n<li><a href=\"#1-2-iphone%EC%97%90-ssl-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%84%A4%EC%B9%98\">1-2. iPhone에 SSL 인증서 설치</a></li>\n<li><a href=\"#1-3-charles-%EC%8B%A4%ED%96%89\">1-3. Charles 실행</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#2-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%84%9C%EB%B2%84-%EA%B5%AC%EC%B6%95\">2. 프록시 서버 구축</a></p>\n<ul>\n<li><a href=\"#2-1-%EC%99%9C-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%84%9C%EB%B2%84%EA%B0%80-%ED%95%84%EC%9A%94%ED%95%9C%EA%B0%80\">2-1. 왜 프록시 서버가 필요한가?</a></li>\n<li><a href=\"#2-2-express%EB%A1%9C-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%84%9C%EB%B2%84-%EB%A7%8C%EB%93%A4%EA%B8%B0\">2-2. Express로 간단한 서버 만들기</a></li>\n<li><a href=\"#2-3-%ED%94%84%EB%A1%9D%EC%8B%9C-%EC%84%9C%EB%B2%84-%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%84%A4%EC%A0%95\">2-3. 프록시 서버 도메인 설정</a></li>\n<li><a href=\"#2-4-ssl-%EC%9D%B8%EC%A6%9D-%ED%99%9C%EC%84%B1%ED%99%94\">2-4. SSL 인증 활성화</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"0. 들어가며 부산 지하철 실시간 도착정보 서비스를 만들기 위해 가장 먼저 준비해야 하는 것은 그 실시간 도착정보를 가져오는 것이다. 공공데이터포털, 레일포털, 카카오맵 API 등을 모두 찾아 보았으나, OpenAPI 형태로 실시간 도착정보를 제공하는 곳은 없었다. 어쩔 수 없이 카카오맵 앱 내부적으로 사용되는 API를 사용하여 실시간 도착정보를 찾아내기로 했다. 이 내부 API는 외부에 공개되지 않기 때문에 네트워크 패킷을 분석하여 찾아내야 한다. 1. 카카오맵 내부 API 찾아내기 휴대폰에서 통신되는 네트워크 패킷을 컴퓨터에서 찾아낼 수 있는 소프트웨어를 검색해보니 Charles Proxy가 있었다. 30일 무료 평가판에 세션 시간 제한 등 제약이 있었지만, 카카오맵 내부 API를 찾아내는 데에는 문제가 없어 보였다. Charles Proxy를 Mac에 설치한 뒤 iPhone에서 몇 가지 설정을 만져 주었다. 1-1. iPhone Wi-Fi 설정 변경 iPhone을 컴퓨터와 동…","frontmatter":{"date":"June 21, 2024","title":"subway-live 작업기 2부. API 작업","categories":"웹개발","author":"이승준","emoji":"🚇"},"fields":{"slug":"/subway-live-2/"}},"next":{"id":"86cb470d-a7d6-5cf1-877a-b0b30a74b88e","html":"<h1 id=\"0-들어가며\" style=\"position:relative;\"><a href=\"#0-%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\" aria-label=\"0 들어가며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0. 들어가며</h1>\n<p>iOS 앱들을 보다 보면 어떤 앱에서 어떤 네트워크 요청을 주고 받는지 궁금할 때가 있다. 이럴 때, Charles Proxy라는 네트워크 스니핑(sniffing) 도구를 활용하면 간단하게 확인할 수 있다.</p>\n<h1 id=\"1-준비사항\" style=\"position:relative;\"><a href=\"#1-%EC%A4%80%EB%B9%84%EC%82%AC%ED%95%AD\" aria-label=\"1 준비사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 준비사항</h1>\n<h2 id=\"1-1-charles-proxy-설치\" style=\"position:relative;\"><a href=\"#1-1-charles-proxy-%EC%84%A4%EC%B9%98\" aria-label=\"1 1 charles proxy 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-1. Charles Proxy 설치</h2>\n<p>컴퓨터에 최신 버전의 <a href=\"https://www.charlesproxy.com/download/\">Charles Proxy</a>를 설치한다. 30일 무료 평가판을 사용할 수 있으며, 이후에는 $50을 지불하고 사용해야 한다. 또 평가판 기간에는 세션 당 30분의 시간 제한이 있다.</p>\n<h2 id=\"1-2-iphone-와이파이-설정-변경\" style=\"position:relative;\"><a href=\"#1-2-iphone-%EC%99%80%EC%9D%B4%ED%8C%8C%EC%9D%B4-%EC%84%A4%EC%A0%95-%EB%B3%80%EA%B2%BD\" aria-label=\"1 2 iphone 와이파이 설정 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-2. iPhone 와이파이 설정 변경</h2>\n<p>컴퓨터와 동일한 Wi-Fi 네트워크에 연결된 iPhone을 준비한다. iPhone의 설정에 들어가 <code class=\"language-text\">Wi-Fi > 해당 네트워크 옆 🛈</code>을 누르고 맨 밑으로 내리면 <code class=\"language-text\">Configure Proxy</code>(<code class=\"language-text\">프록시 구성</code>)이 있을 것이다. <code class=\"language-text\">Manual</code>로 바꿔주고 Server는 컴퓨터의 IP 주소, Port는 <code class=\"language-text\">8888</code>로 설정한다. 컴퓨터의 IP 주소를 알아내는 방법은 다음과 같다.</p>\n<ul>\n<li>Windows: <code class=\"language-text\">Command Prompt</code>를 열고 <code class=\"language-text\">ipconfig</code>를 입력하면 나오는 IPv4 주소</li>\n<li>Mac: <code class=\"language-text\">System Preferences > Wi-Fi</code>에 들어가 해당 네트워크 옆 <code class=\"language-text\">Details</code>를 누르면 나오는 IP 주소</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 216.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAIAAAD3xz8iAAAACXBIWXMAAAsTAAALEwEAmpwYAAACeUlEQVR42u1W627aMBjN+z9GpT1Eq5V2g6oITas2Ki4JZMC4BEIuxPckkB3HjCFGU7SfE9bB+hznfPcYW0kigOUynE691Soyy7OIYxaGiecFtu1CxhMLP0LVt++dh4f642MjCBJC5GbDDzA0StN2u+s4P15e2jc3H3w/plRZJBGUCMEUZykhSusikvOMsRQzOHgJgtGIGUshcgjasj2XX0ay5cqfK0ETDi9ms1Wj0by9/VivN1utr5CfnprzuQ+acQTRIUy4Y/mhWKzF1BdBLIiOTUYRnUwW4/HcdSeet14ug9FoZsI5BB9FBIosQsDhlEAlIhQAtuEzHGYM3ioASyg1u+YFA50wITMpMyFSKfcQAoEdZi0ctspdDVi1pMzDMBwMBkVR7Ha74uJBqbQYU3meK6UM+ZKBFwFNFiJLkmQ8Hs9mM0JItX2zEfFCZgVn0uIciWFgLhYe5xx72+222mwsdirfMVa6nWVoBj3iOL7E/1O3+/0+coYZXrybud0hYSgVPE9T5EwDNeBcnQV8PMbvD4PIsntkHJuPQZwF2hPdUvaP2vd2uWZxvMFcmaoiSQg6IioH5+hCpWNGnmzbHg6HIFeEGgQBKjrFd+95SBOC1dkGB31yWXsUKI0QAgxtGe0Jlb1ez3SI8fysZeOX67rN5nMQrOGytnyiu9o4fERtIOzrvNlsut3u62vbcZxut4eCvxV8GWDm+76USscMBZAIoUgmITjWKOQ0RWj538BzzlEkqlS6bxIApTtGxRlq+uLPYfDPuJKv5Cv5vyYf36NO7lTvk8196QSHo+dNMtTjytXpOHd3tVrt8/39JwAClp2OjT+mE/u/AA9Vm+61LKuyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ios-tracking-1.png\"\n        title=\"\"\n        src=\"/static/e3c19cea906a4bff6d613557b6f64a7e/b4ad3/ios-tracking-1.png\"\n        srcset=\"/static/e3c19cea906a4bff6d613557b6f64a7e/8c112/ios-tracking-1.png 270w,\n/static/e3c19cea906a4bff6d613557b6f64a7e/03ec9/ios-tracking-1.png 540w,\n/static/e3c19cea906a4bff6d613557b6f64a7e/b4ad3/ios-tracking-1.png 1080w,\n/static/e3c19cea906a4bff6d613557b6f64a7e/c4688/ios-tracking-1.png 1179w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"1-4-ssl-인증서-설치\" style=\"position:relative;\"><a href=\"#1-4-ssl-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%84%A4%EC%B9%98\" aria-label=\"1 4 ssl 인증서 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-4. SSL 인증서 설치</h2>\n<p>iPhone의 Safari에서 <a href=\"https://chls.pro/ssl\">SSL 인증서</a>를 다운로드하여 설치한다. 이후 iPhone의 설정에 들어가 아래 경로에서 Charles Proxy의 인증서를 활성화한다.</p>\n<ul>\n<li>영문: <code class=\"language-text\">General > About > Certificate Trust Settings > Enable Full Trust for Root Certificates</code></li>\n<li>한글: <code class=\"language-text\">일반 > 정보 > 인증서 신뢰 설정 > 루트 인증서 전체 신뢰 활성화</code></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 216.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAIAAAD3xz8iAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC7UlEQVR42u1W204bMRDND/e139C3fgJSPwPEpS0CBEhQSiOFhFz26t14vd6L7d21Az32hoirkCr1jWEymhn7xJ7jcfCgLBU0SVgQJHFMi0L2mZfKuWCsJCQbjaZ5XldVM7ADVXP568/BweHl5TWywD9TwOq6vboajsezi4vfW1vf0jRHZlCVqi6VEq2UnRBQ7axVDD/4WkqrWA1JpUy/l8Eoaq795nTajKKWUn50dLq7+31//+fx8dn5+eXJyfnZ2cXOzh6Sh4cnWBD4TWmDlClCpZfImErGKs+LfZ/M5+FiEWEqwjBMYRHe3nqYAExfiwXXlWpUq7uV1tA7Y6Cr1eoeoVK6bVdta2C7boU8fCSbBrazYFcJFrQym82SJIEznU6zLLt/JFrrLGN5nhdFgaG2BR3tAB9jDGLOubMFY4wQgm8E5u5BMEcIJYQErMHSRlswSFYKHBSYzZ3kThDePZXNFupaaG3WYCnlYrEIw3A+n/u+1ztxHN+/Jl3XMpavt426gQcl2AtY6W0fuu99ogCIdUe0ljCcG6VlEKRxnKH10pRH0ZIQlM2iiCZJDscNWUtp4foUPSd7MGhoyhJdWdc1fJy+4LxCyFiR5+WDVrAYcos3WNyC0WsgeTIZo8jJZIJqwzC4f0PQAdpo5o4KeEsYqAfboK1ygg1s6N2QbH33ZzpD8wycb45KUUqXS4oTxi5QVrpc8qLIOUcmQumU2saom7BJP4++3oiFMHINFqIOfW82nZA4JHEUR0EchZxly5QkCQk8W4jnexmhnoo/Db+MylmFhfsrmVdtzA0pVnFuotwQDrvyMzjaZyZgd6UwXWuk0spezzYteF03ju1SLZm9VUEq/VQunINw48yIxAT3kyC5u0xVCY7clbQBTqtWuF5Q0Wu9zvQ+Jrz6w2TBhdOXTvEo8yb4n/UD/AH+AH+A/wv45VNq8wh5H9y/l54pku+A3T8sPRyOt7f39vZ+4PkEhYNwOLzBg+zZ+n8BVzeDZAJWhnMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ios-tracking-2.png\"\n        title=\"\"\n        src=\"/static/dc76bda02ce5af533be44677ecfb63d0/b4ad3/ios-tracking-2.png\"\n        srcset=\"/static/dc76bda02ce5af533be44677ecfb63d0/8c112/ios-tracking-2.png 270w,\n/static/dc76bda02ce5af533be44677ecfb63d0/03ec9/ios-tracking-2.png 540w,\n/static/dc76bda02ce5af533be44677ecfb63d0/b4ad3/ios-tracking-2.png 1080w,\n/static/dc76bda02ce5af533be44677ecfb63d0/c4688/ios-tracking-2.png 1179w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1 id=\"2-charles-실행-및-설정\" style=\"position:relative;\"><a href=\"#2-charles-%EC%8B%A4%ED%96%89-%EB%B0%8F-%EC%84%A4%EC%A0%95\" aria-label=\"2 charles 실행 및 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Charles 실행 및 설정</h1>\n<h2 id=\"2-1-ssl-proxying-설정\" style=\"position:relative;\"><a href=\"#2-1-ssl-proxying-%EC%84%A4%EC%A0%95\" aria-label=\"2 1 ssl proxying 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-1. SSL Proxying 설정</h2>\n<p>Charles를 실행하고 <code class=\"language-text\">Proxy > SSL Proxying Settings</code>에 들어가서 <code class=\"language-text\">Enable SSL Proxying</code>을 체크한다. 이후 <code class=\"language-text\">Add</code>를 눌러 <code class=\"language-text\">Host</code>에 <code class=\"language-text\">*</code>를 입력한다. 이렇게 하면 모든 도메인으로 들어오는 SSL 트래픽을 Charles가 스니핑할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.7037037037037%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACk0lEQVR42q1US2/aQBCmlXJrrlRqD6QS9yjHqr+mPeQ3tKcox95RYyRy6ZG/EN4VEeVQAQ4GQzB2eGMMGPM0dqcz26xDSVXl0JE+zTAz++3w7a59PrTw6elBJPL5MBQNvYhGowyhUIjh7OzMizn2eyKRyGE4HD7wcev8KHzqdJpD1WjVLdNSptOpMpvNlPF4rDQaDeX29lap1+sMVDNNk9XvUUMYmqZ99AjrsnwBaMbYcAzDAFwEvV4P2u02YCN0u10vbrVaMBgMoNPpsBhrW1qLG3/xCEVRvLCsOaiqajebTRe9i1O51WrVlWWZxTidW6vVWI7HlUqFahs0KJVKD4SSJAkjXYd47MpJp9OQSCQgk8kwn0qlIJlMQjwe92LqIR+LxSCfz2/RgIbyCKuSKPQnC7i6Ljj53DV8z+chl8vBzc0N4GaAUzFQjBMz4HTsN/7Vx4TlclmYmhYUxLKjaSrThzQjHUkv8kSiKAr0+30P91pubdveIxRFwZyvoKINHU1VYTgcwmQyATogPGnQUQ7K3d3dsc12a6PR6PGEolgUFqsN6Jbt2Cgw7chBzcvlkoHi3RphvV5vXdf9k7BYFIXNZo0NG2d/ASdcLBZPJxSLRWGNk+HxO/tkhNVq5U3ISXmMa/5CiBrSAtTDIV1In12dSD+uK/awi89r/YG+XduPNBQv5vM53XobRXcJeLLMY87dzeHr+F3DfL/XdS29tYGfK7xiOxcb75JAzwdJHdKKgx8GB8+TBPOZCePZEi4LzjY2AJDkxsOE2Wz2HEl1fE70AdDQ/xPUI5XLWkmStVBMU75m2+N4+ts553vu9/tfHh0dHQcCgZOnIhgMIgInH96+Onn/7vXxG+QgLt+OPfsP8P0Ct128E4VqLD0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ios-tracking-3.png\"\n        title=\"\"\n        src=\"/static/649ab9df956608d2d15d7a52f7234782/b4ad3/ios-tracking-3.png\"\n        srcset=\"/static/649ab9df956608d2d15d7a52f7234782/8c112/ios-tracking-3.png 270w,\n/static/649ab9df956608d2d15d7a52f7234782/03ec9/ios-tracking-3.png 540w,\n/static/649ab9df956608d2d15d7a52f7234782/b4ad3/ios-tracking-3.png 1080w,\n/static/649ab9df956608d2d15d7a52f7234782/ced39/ios-tracking-3.png 1408w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"2-2-패킷-분석\" style=\"position:relative;\"><a href=\"#2-2-%ED%8C%A8%ED%82%B7-%EB%B6%84%EC%84%9D\" aria-label=\"2 2 패킷 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-2. 패킷 분석</h2>\n<p>이제 아래 사진과 같이 앱에서 특정 동작을 수행하면 발생하는 JSON Request의 내용을 볼 수 있다. 이러한 네트워크 트래킹은 외부에 공개 시 문제의 소지가 발생할 가능성이 크므로, 대부분의 정보를 블러 처리하고 올리는 점 양해 바란다. 이처럼 상업적으로 운용되는 앱에 대해서 네트워크 패킷 분석은 개인적인 용도로만 사용하는 것이 바람직하다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1080px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.81481481481481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACg0lEQVR42qWTzU7bQBDHc+qBF2jpm1S9hD5S63fiAhxaqRwANVGAQ2rFLg6xBArg2Pmw13HsxE5ir73TmU2chtJSVaz01+yOPL+dmR1X1MPDXV2tfdKvrxVd15VWq7WWquhom82m0mg0lG/1utJUVUXVW4q6+eaXMPbj+fn528rJ8Zdq99aEvm2B7w1FFIwhDBhMAxfGrgv31gN0TBPubQcG7gjs4QBGrgfj8VjK930RBAG4+C0C9yqN70a12WX59YPLR2GaubOceyiycQq8KHJuWRbvOw6fzWZ8Pp/z5WIhbZIkpGyB5yiK8lqttlfZPzGqn/UQvrZcOG1PxElnCqedEI6NELreAni2hMFgAIwxwEAphEGe51AUBXDOBVnyn52dfagYplFN4giSyIc8WwjYWhRE5di2LaGkfr8vS82yrITKmDRNV0BNM6prHy1B21ICxTGQ+jMcDmE6nQKWKDMku1wunwINg4AFBkv/owzXPpnZzc2NtPgI8oLJZCKh2FdB2RJ8AywDfwfGcQwMAQ6CLCy71+uB49ibnnqeRxJ0Calerz8PTLA0f+RA6PUhHrvY+Lns3bawVJkhPQrO4vNA8heRC7lvAZ+M4C9LlA/Ybrf/DeThCFLWgzRkwOczerYXAEk4h+nwFlLfhiKJVk//EmCepZB59wjsQR4HGyDFbE/GIyAeyFmslyhF/iyJBJ/6gicTUWRLUSa+pUIWkmXCNM09HGxNzuGfMlzNZ7Fyi/xR/8pf70mGR0dH7xDqYaYe3uB1u11Guru7Y51Oh2mazq6urpiu/2AtTcOzhnudXV5esouLC0ZxCKKzd3Bw8L6C6xXqDWr3f7SzsyO15XtNrJ9wnpboFgiuIQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ios-tracking-4.png\"\n        title=\"\"\n        src=\"/static/e367ad25ecfb7684e36bee78048d1865/b4ad3/ios-tracking-4.png\"\n        srcset=\"/static/e367ad25ecfb7684e36bee78048d1865/8c112/ios-tracking-4.png 270w,\n/static/e367ad25ecfb7684e36bee78048d1865/03ec9/ios-tracking-4.png 540w,\n/static/e367ad25ecfb7684e36bee78048d1865/b4ad3/ios-tracking-4.png 1080w,\n/static/e367ad25ecfb7684e36bee78048d1865/399e3/ios-tracking-4.png 1620w,\n/static/e367ad25ecfb7684e36bee78048d1865/36aa2/ios-tracking-4.png 2160w,\n/static/e367ad25ecfb7684e36bee78048d1865/bda1b/ios-tracking-4.png 2698w\"\n        sizes=\"(max-width: 1080px) 100vw, 1080px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#1-1-charles-proxy-%EC%84%A4%EC%B9%98\">1-1. Charles Proxy 설치</a></li>\n<li><a href=\"#1-2-iphone-%EC%99%80%EC%9D%B4%ED%8C%8C%EC%9D%B4-%EC%84%A4%EC%A0%95-%EB%B3%80%EA%B2%BD\">1-2. iPhone 와이파이 설정 변경</a></li>\n<li><a href=\"#1-4-ssl-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%84%A4%EC%B9%98\">1-4. SSL 인증서 설치</a></li>\n<li><a href=\"#2-1-ssl-proxying-%EC%84%A4%EC%A0%95\">2-1. SSL Proxying 설정</a></li>\n<li><a href=\"#2-2-%ED%8C%A8%ED%82%B7-%EB%B6%84%EC%84%9D\">2-2. 패킷 분석</a></li>\n</ul>\n</div>","frontmatter":{"date":"June 07, 2024","title":"iOS 앱 네트워크 트래킹","categories":"네트워크","author":"이승준","emoji":"📱"},"fields":{"slug":"/ios-tracking/"}},"prev":{"id":"5c02a89a-3c7b-55ef-9ce9-bbdb13493d65","html":"<h2 id=\"0-들어가며\" style=\"position:relative;\"><a href=\"#0-%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\" aria-label=\"0 들어가며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0. 들어가며</h2>\n<p>다음으로는 데이터를 수집하고 처리하여 최종적으로 <code class=\"language-text\">역별 시간표</code>와 <code class=\"language-text\">열차별 시간표</code> 이 두 가지를 생성하는 과정을 거쳤다.</p>\n<h2 id=\"1-카카오맵-api에서-역-id-찾기\" style=\"position:relative;\"><a href=\"#1-%EC%B9%B4%EC%B9%B4%EC%98%A4%EB%A7%B5-api%EC%97%90%EC%84%9C-%EC%97%AD-id-%EC%B0%BE%EA%B8%B0\" aria-label=\"1 카카오맵 api에서 역 id 찾기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 카카오맵 API에서 역 ID 찾기</h2>\n<p>iPhone 카카오맵 앱에서 출발지점을 바꿔가며 역 ID를 찾아내었는데, 대부분 연속된 숫자라 찾기 그렇게 어렵지는 않았다. 다만 새로 개통한 <em>1호선 다대포해수욕장 연장구간</em>, <em>동해선 태화강 연장구간</em>, <em>동해선 부산원동역</em> 이 세 가지는 다소 변칙적이었다.</p>\n<ul>\n<li>1호선\n<ul>\n<li>신평~노포: <code class=\"language-text\">PSS101</code>~<code class=\"language-text\">PSS134</code></li>\n<li>동매~다대포해수욕장: <code class=\"language-text\">PSS1M159</code>~<code class=\"language-text\">PSS1M164</code></li>\n</ul>\n</li>\n<li>2호선\n<ul>\n<li>장산~양산: <code class=\"language-text\">PSS201</code>~<code class=\"language-text\">PSS243</code></li>\n</ul>\n</li>\n<li>3호선\n<ul>\n<li>수영~대저: <code class=\"language-text\">PSS301</code>~<code class=\"language-text\">PSS317</code></li>\n</ul>\n</li>\n<li>4호선\n<ul>\n<li>미남~안평: <code class=\"language-text\">PSS401</code>~<code class=\"language-text\">PSS414</code></li>\n</ul>\n</li>\n<li>부산김해경전철\n<ul>\n<li>사상~가야대: <code class=\"language-text\">PSS1001</code>~<code class=\"language-text\">PSS1021</code></li>\n</ul>\n</li>\n<li>동해선\n<ul>\n<li>부전~일광 (부산원동 제외): <code class=\"language-text\">PSS11M144</code>~<code class=\"language-text\">PSS11M157</code></li>\n<li>부산원동: <code class=\"language-text\">PSS11M226</code></li>\n<li>좌천~태화강: <code class=\"language-text\">PSS11M248</code>~<code class=\"language-text\">PSS11M255</code></li>\n</ul>\n</li>\n</ul>\n<p>이 데이터를 최종적으로 <code class=\"language-text\">stations.json</code>에 저장하였다.</p>\n<h2 id=\"2-전체-역-시간표-만들기\" style=\"position:relative;\"><a href=\"#2-%EC%A0%84%EC%B2%B4-%EC%97%AD-%EC%8B%9C%EA%B0%84%ED%91%9C-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"2 전체 역 시간표 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 전체 역 시간표 만들기</h2>\n<p>이 파트가 전체 모든 과정 중 가장 애를 먹였는데, 처음에는 코드만 잘 짜놓으면 쉽게 넘어갈 수 있다고 생각했으나 예상치 못했던 변수가 너무 많았기 때문이다. 근본적으로는 raw data 자체에 문제가 많았기 때문이라고 볼 수 있다.</p>\n<h3 id=\"2-1-raw-data-찾기\" style=\"position:relative;\"><a href=\"#2-1-raw-data-%EC%B0%BE%EA%B8%B0\" aria-label=\"2 1 raw data 찾기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-1. raw data 찾기</h3>\n<p>총 4가지의 raw data를 찾을 수 있었는데, 그 중 완벽한 데이터는 없었다. 문제점 중 골치 아프지만 해결이 불가능하지는 않은 것은 ⚠️, 해결 자체가 불가능한 것은 ❌로 표시하였다.</p>\n<ol>\n<li><strong>카카오맵 내부 API</strong></li>\n</ol>\n<ul>\n<li><a href=\"https://api.kakao.com/subway/station/timetable.json\">https://api.kakao.com/subway/station/timetable.json</a> (실제 링크는 아님) 뒤 역 ID를 입력하여 요청을 보내면 JSON 포맷으로 가공되어 데이터가 나오기 때문에 매우 쉽게 처리가 가능하다.</li>\n<li>문제점\n<ol>\n<li>❌ <strong>열차번호 정보가 없다</strong>. 이 데이터로 역별 시간표는 만들 수 있지만, 열차별 시간표는 만들 수 없다.</li>\n<li>❌ 종착역에 도착하는 열차의 도착시간 정보가 없다.</li>\n</ol>\n</li>\n</ul>\n<ol start=\"2\">\n<li><strong>공공데이터포털/레일포털 운행정보</strong></li>\n</ol>\n<ul>\n<li>공공데이터포털에 부산교통공사에서 제공하는 <a href=\"https://www.data.go.kr/data/15082980/fileData.do\">부산도시철도 운행 정보</a>라는 csv 파일이 있다. 이 파일에는 열차별 &#x26; 역별 도착 및 출발시각이 모두 들어있다.</li>\n<li>조사를 좀 더 해보니 레일포털에서는 <a href=\"https://data.kric.go.kr/rips/M_01_01/detail.do?id=11\">부산교통공사</a>뿐만 아니라 <a href=\"https://data.kric.go.kr/rips/M_01_01/detail.do?id=12\">김해경전철</a>, <a href=\"https://data.kric.go.kr/rips/M_01_01/detail.do?id=6\">코레일</a> 등 전체 운영기관의 xlsx 파일을 제공한다.</li>\n<li>문제점\n<ol>\n<li>❌ 부산김해경전철 파일에서 평일, 토요일, 휴일 시간표를 모두 같게 해놨다.</li>\n<li>❌ 동해선 파일에서 역별 도착, 출발 시간이 표시되어 있지 않다.</li>\n<li>⚠️ 역별 도착 및 출발시각이 분 단위로 있어, 초 단위 정보는 <code class=\"language-text\">방법 1</code>로 얻어야 한다. 이때 대부분의 경우 표기된 시각이 초 시각을 버림한 경우이지만, 일부 열차에서는 초 시각을 반올림하여 시간이 맞지 않은 경우가 있다. 이 경우 오류가 나는 경우를 csv에서 일일이 찾아서 파일을 수정해야 한다.</li>\n</ol>\n</li>\n</ul>\n<ol start=\"3\">\n<li><strong>레일블루</strong></li>\n</ol>\n<ul>\n<li>개인이 운영하는 철도 정보 관련 웹사이트이다. 이 중 <a href=\"https://rail.blue/railroad/logis/timetable_schedule_sel.aspx\">전철노선시간표</a>에 들어가 정보를 입력하면 열차별 &#x26; 역별 도착 및 출발시각이 조회 가능하다.</li>\n<li>문제점\n<ol>\n<li>❌ 부산김해경전철의 열차번호가 후술할 레일포털에서 제공하는 표준데이터의 열차번호와 다르다.</li>\n<li>❌ 부산김해경전철 토⋅일⋅공휴일의 가야대행 막차 직전 열차의 정보가 없다. 추측컨대 예전에 없다가 최근에 새로 생긴 듯한데, 아직 레일블루에 업데이트되지 않았다.</li>\n<li>❌ 동해선 전철노선시간표에 재송역이 빠져 있다.</li>\n<li>⚠️ 4호선 (전)동부산대학역이 아직 (현)윗반송역으로 업데이트되지 않았다. 이로 인해 윗반송역 시간표가 텅 비어있다.</li>\n<li>⚠️ 동해선 일광~태화강 구간의 일부 열차에서 카카오맵 API와 다르게 표시되어 있다.</li>\n</ol>\n</li>\n</ul>\n<ol start=\"4\">\n<li><strong>레일포털 Open API</strong></li>\n</ol>\n<ul>\n<li>국토교통부에서 제공하는 Open API 중 <a href=\"https://data.kric.go.kr/rips/M_01_02/detail.do?id=162&#x26;service=trainUseInfo&#x26;operation=subwayTimetable\">열차별 운행시각표</a>가 있다. 본인인증을 하고 활용신청을 하니 얼마 지나지 않아 메일로 <code class=\"language-text\">serviceKey</code>를 받을 수 있었다.</li>\n<li>요일 코드(<code class=\"language-text\">dayCd</code>)는 토요일이 <code class=\"language-text\">7</code>, 평일이 <code class=\"language-text\">8</code>, 휴일이 <code class=\"language-text\">9</code>이다.</li>\n<li>노선 코드(<code class=\"language-text\">lnCd</code>), 운영기관 코드(<code class=\"language-text\">railOprIsttCd</code>), 역 코드(<code class=\"language-text\">stinCd</code>) 정보는 <a href=\"https://data.kric.go.kr/rips/M_04_02/detail.do?id=12\">자료실</a>에서 엑셀 파일로 제공한다.</li>\n<li>문제점\n<ol>\n<li>⚠️ 도착시간은 제대로 표시되어 있지만, 출발시간을 도착시간과 동일하게 표시해놓았다. 이는 <code class=\"language-text\">방법 1</code>과 병용하면 해결이 가능하다.</li>\n<li>⚠️ 1~4호선, 김해경전철 일부 열차에서 시간이 카카오맵 API와 다르게 표시되어 있다.</li>\n<li>⚠️ 일부 열차에서 시각이 <code class=\"language-text\">방법 1</code>과 다르게 표기되어 있어 문제가 되는 부분을 수동으로 수정해야 한다.</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"2-2-데이터-전처리-방법-계획하기\" style=\"position:relative;\"><a href=\"#2-2-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%84%EC%B2%98%EB%A6%AC-%EB%B0%A9%EB%B2%95-%EA%B3%84%ED%9A%8D%ED%95%98%EA%B8%B0\" aria-label=\"2 2 데이터 전처리 방법 계획하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-2. 데이터 전처리 방법 계획하기</h3>\n<p><strong>⭐️ 전제: raw data간 시간이 서로 달라 충돌하는 경우, 항상 <code class=\"language-text\">방법 1</code>의 시간을 취한다.</strong></p>\n<p>아래에 정리된 바와 같이, <code class=\"language-text\">방법 2</code>, <code class=\"language-text\">방법 3</code>, <code class=\"language-text\">방법 4</code> 모두 결점이 있어서 <code class=\"language-text\">방법 1</code>과의 비교를 통해 보완을 해야 했다.</p>\n<ul>\n<li>(<code class=\"language-text\">방법 2</code>) 공공데이터포털/레일포털 운행정보\n<ul>\n<li>⚠️ 부산교통공사 관할 1~4호선: 오류가 나는 열차에 대해 일일이 csv에서 수정해줘야 한다.</li>\n<li>❌ 부산김해경전철: 토요일 및 휴일 시간표가 없다.</li>\n<li>❌ 동해선: 역별 도착, 출발 시간이 표시되어 있지 않다.</li>\n</ul>\n</li>\n<li>(<code class=\"language-text\">방법 3</code>) 레일블루\n<ul>\n<li>⚠️ 부산교통공사 관할 1~4호선: 4호선 윗반송역 시간표가 텅 비어있는데, 이를 채우기엔 다소 까다롭다.</li>\n<li>❌ 부산김해경전철: 열차번호가 표준이 아니며, 토⋅일⋅공휴일의 가야대행 막차 직전 열차의 정보가 없다.</li>\n<li>❌ 동해선: 재송역 열차시간이 존재하지 않는다.</li>\n</ul>\n</li>\n<li>(<code class=\"language-text\">방법 4</code>) 레일포털 Open API\n<ul>\n<li>⚠️ 부산교통공사 관할 1~4호선: 일부 열차에서 시간이 다르게 표시되어 있어 직접 수정이 필요하다.</li>\n<li>⚠️ 김해경전철: 마찬가지 문제가 있다.</li>\n<li>✅ 동해선: 별다른 문제가 없다.</li>\n</ul>\n</li>\n</ul>\n<p>처음에는 부산교통공사 관할 1~4호선에서는 <code class=\"language-text\">방법 2</code>를, 나머지 노선들에 대해서는 <code class=\"language-text\">방법 4</code>를 이용하였는데, <code class=\"language-text\">방법 2</code>에서 문제가 있는 데이터가 너무 많아(<code class=\"language-text\">방법 2</code>의 <code class=\"language-text\">문제점 iii</code>) <code class=\"language-text\">방법 4</code>로 통일하였다.</p>\n<h3 id=\"2-3-데이터-전처리-하기\" style=\"position:relative;\"><a href=\"#2-3-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%84%EC%B2%98%EB%A6%AC-%ED%95%98%EA%B8%B0\" aria-label=\"2 3 데이터 전처리 하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-3. 데이터 전처리 하기</h3>\n<p>이제 본격적으로 데이터를 전처리해보겠다. 전처리의 각 과정에 등장하는 코드의 설명까지 일일이 달기에는 문서 양이 너무 방대해져, 코드의 주요 부분에 주석으로 설명을 단 뒤 Github 링크를 걸어두도록 하겠다.</p>\n<ol>\n<li><a href=\"https://data.kric.go.kr/rips/M_04_02/detail.do?id=12\">코드 정보</a>를 받아와서 전처리 후 <code class=\"language-text\">codes.csv</code> 파일로 저장</li>\n<li><a href=\"https://github.com/leesj-dev/subway-live/blob/master/preprocessing/scripts/1-save_arrival.py\"><code class=\"language-text\">1-save_arrival.py</code></a> 실행 → <code class=\"language-text\">arrival_original.json</code>으로 저장</li>\n</ol>\n<ul>\n<li>이 코드는 <code class=\"language-text\">방법 1</code>과 <code class=\"language-text\">방법 4</code>에서 열차번호, 종착역, 출발시각, 도착시각 정보를 가져와 <code class=\"language-text\">arrival_original.json</code>에 저장한다.</li>\n<li><code class=\"language-text\">방법 1</code>과 <code class=\"language-text\">방법 4</code> 간 시간이 맞지 않은 부분이 몇 개 있어 열차번호가 모두 채워지지 않는데(<code class=\"language-text\">방법 4</code>의 <code class=\"language-text\">문제점 ii</code>), 이러한 문제가 발생하는 경우를 모두 정리하여 if문으로 예외처리하였다.</li>\n</ul>\n<ol start=\"3\">\n<li><a href=\"https://github.com/leesj-dev/subway-live/blob/master/preprocessing/scripts/2-fill_end_station.py\"><code class=\"language-text\">2-fill_end_station.py</code></a> 실행 → <code class=\"language-text\">arrival.json</code>으로 저장</li>\n</ol>\n<ul>\n<li>이 코드는 <code class=\"language-text\">방법 4</code>를 통해 종착역에 도착하는 열차 정보를 가져옴으로써 <code class=\"language-text\">방법 1</code>의 <code class=\"language-text\">문제점 ii</code>를 해결한다. <code class=\"language-text\">arrival_original.json</code>에서 종착역이 없는 열차들을 채워 <code class=\"language-text\">arrival.json</code>에 저장한다.</li>\n</ul>\n<p>환경변수는 <a href=\"https://github.com/leesj-dev/subway-live/blob/master/preprocessing/scripts/env_variables.py\"><code class=\"language-text\">env_variables.py</code></a>, 파일경로는 <a href=\"https://github.com/leesj-dev/subway-live/blob/master/preprocessing/scripts/paths.py\"><code class=\"language-text\">paths.py</code></a>, 재사용하는 함수들은 <a href=\"https://github.com/leesj-dev/subway-live/blob/master/preprocessing/scripts/utils.py\"><code class=\"language-text\">utils.py</code></a>에 넣어 필요할 때 불러와 사용하였다.</p>\n<h2 id=\"3-개별-열차-시간표-파일-생성\" style=\"position:relative;\"><a href=\"#3-%EA%B0%9C%EB%B3%84-%EC%97%B4%EC%B0%A8-%EC%8B%9C%EA%B0%84%ED%91%9C-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1\" aria-label=\"3 개별 열차 시간표 파일 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 개별 열차 시간표 파일 생성</h2>\n<ul>\n<li><a href=\"https://github.com/leesj-dev/subway-live/blob/master/preprocessing/scripts/3-save_traintable.py\"><code class=\"language-text\">3-save_traintable.py</code></a> 실행 → <code class=\"language-text\">traintable</code> 폴더에 열차별 시간표 생성</li>\n</ul>\n<h2 id=\"4-개별-역-시간표-파일-생성\" style=\"position:relative;\"><a href=\"#4-%EA%B0%9C%EB%B3%84-%EC%97%AD-%EC%8B%9C%EA%B0%84%ED%91%9C-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1\" aria-label=\"4 개별 역 시간표 파일 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 개별 역 시간표 파일 생성</h2>\n<ul>\n<li><a href=\"https://github.com/leesj-dev/subway-live/blob/master/preprocessing/scripts/4-save_timetable.py\"><code class=\"language-text\">4-save_timetable.py</code></a> 실행 →\n<ol>\n<li><code class=\"language-text\">timetable</code> 폴더에 역별 시간표 생성</li>\n<li><code class=\"language-text\">arrival.json</code> 중 부산교통공사(BTC)의 출발·도착시간 부분을 hh:mm에서 hh:mm:ss으로 업데이트</li>\n</ol>\n</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#0-%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\">0. 들어가며</a></p>\n</li>\n<li>\n<p><a href=\"#1-%EC%B9%B4%EC%B9%B4%EC%98%A4%EB%A7%B5-api%EC%97%90%EC%84%9C-%EC%97%AD-id-%EC%B0%BE%EA%B8%B0\">1. 카카오맵 API에서 역 ID 찾기</a></p>\n</li>\n<li>\n<p><a href=\"#2-%EC%A0%84%EC%B2%B4-%EC%97%AD-%EC%8B%9C%EA%B0%84%ED%91%9C-%EB%A7%8C%EB%93%A4%EA%B8%B0\">2. 전체 역 시간표 만들기</a></p>\n<ul>\n<li><a href=\"#2-1-raw-data-%EC%B0%BE%EA%B8%B0\">2-1. raw data 찾기</a></li>\n<li><a href=\"#2-2-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%84%EC%B2%98%EB%A6%AC-%EB%B0%A9%EB%B2%95-%EA%B3%84%ED%9A%8D%ED%95%98%EA%B8%B0\">2-2. 데이터 전처리 방법 계획하기</a></li>\n<li><a href=\"#2-3-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%84%EC%B2%98%EB%A6%AC-%ED%95%98%EA%B8%B0\">2-3. 데이터 전처리 하기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#3-%EA%B0%9C%EB%B3%84-%EC%97%B4%EC%B0%A8-%EC%8B%9C%EA%B0%84%ED%91%9C-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1\">3. 개별 열차 시간표 파일 생성</a></p>\n</li>\n<li>\n<p><a href=\"#4-%EA%B0%9C%EB%B3%84-%EC%97%AD-%EC%8B%9C%EA%B0%84%ED%91%9C-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1\">4. 개별 역 시간표 파일 생성</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"June 21, 2024","title":"subway-live 작업기 3부. 데이터 전처리","categories":"웹개발","author":"이승준","emoji":"🚇"},"fields":{"slug":"/subway-live-3/"}},"site":{"siteMetadata":{"siteUrl":"https://leesj.me","comments":{"utterances":{"repo":"leesj-dev/leesj-dev.github.io"}}}}},"pageContext":{"slug":"/subway-live-2/","nextSlug":"/ios-tracking/","prevSlug":"/subway-live-3/"}},"staticQueryHashes":["1073350324","2009502679","2938748437"],"slicesMap":{}}